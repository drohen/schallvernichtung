var W={MODE:"production",NODE_ENV:"production",SSR:!1};var h;(function(i){i[i.noDevice=0]="noDevice",i[i.requestingDevice=1]="requestingDevice",i[i.idle=2]="idle",i[i.starting=3]="starting",i[i.ready=4]="ready",i[i.recording=5]="recording",i[i.closing=6]="closing",i[i.error=7]="error"})(h||(h={}));import.meta.env=W;var T=class{constructor(t,e,s,o,n){this.core=t,this.audio=e,this.workerPath=s,this.chunkSize=o,this.recordLength=n,this.mediaTracks=[],this.state=h.noDevice,this.handleRecorderMessage=this.handleRecorderMessage.bind(this),this.audio.context().audioWorklet?this.audio.context().audioWorklet.addModule(this.workerPath).catch(r=>this.emit("error",void 0,r)):(this.recorderNode=this.audio.context().createScriptProcessor(this.chunkSize,1,1),this.processChunk=this.processChunk.bind(this),this.recorderNode.addEventListener("audioprocess",this.processChunk),this.recorderNode.connect(this.audio.context().destination))}setRecorder(){if(this.audio.context().audioWorklet){if(this.recorderNode=new AudioWorkletNode(this.audio.context(),"recording-worklet",{numberOfOutputs:0,numberOfInputs:1}),!this.recorderNode)throw Error("No recording node available to connect");this.audio.getRecorderNode().audioNodeManager.connectOutput(this.recorderNode),this.recorder=this.recorderNode.port}else this.recorder=new Worker(new URL(this.workerPath,import.meta.url),{name:"recording-worker",type:"module"});this.recorder.onmessage=this.handleRecorderMessage,this.postRecorder({command:"init",data:{chunkSize:this.chunkSize,maxLength:this.recordLength,sampleRate:this.audio.context().sampleRate}})}unsetRecorder(){if(this.audio.context().audioWorklet){if(!this.recorderNode)throw Error("No recording node available to disconnect");this.audio.getRecorderNode().audioNodeManager.disconnectOutput(this.recorderNode)}this.recorder=void 0}handleRecorderMessage(t){switch(t.data.message){case"ready":this.emit("state",h.ready);break;case"recording":this.emit("state",h.recording);break;case"done":this.unsetRecorder(),this.emit("state",h.idle),this.core.onRecorded(t.data.buffer);break}}processChunk(t){this.postRecorder({command:"chunk",buffer:t.inputBuffer.getChannelData(0)})}isRecordingEntity(t){return"isRecordingEntity"in t&&t.isRecordingEntity}postRecorder(t){this.recorder?.postMessage(t)}shiftState(t){if(t===this.state)return!1;switch(t){case h.closing:return this.state!==h.recording?!1:(this.state=h.closing,this.postRecorder({command:"stop"}),!0);case h.error:return this.state=h.error,!0;case h.idle:return this.state!==h.closing&&this.state!==h.requestingDevice?!1:(this.state=h.idle,!0);case h.noDevice:return this.state!==h.error?!1:(this.state=h.noDevice,!0);case h.recording:return this.state!==h.ready?!1:(this.state=h.recording,!0);case h.requestingDevice:return this.state!==h.noDevice?!1:(this.state=h.requestingDevice,this.getCapture(),!0);case h.ready:return this.state!==h.starting?!1:(this.state=h.ready,this.postRecorder({command:"start"}),!0);case h.starting:return this.state!==h.idle?!1:(this.state=h.starting,this.setRecorder(),!0)}}emit(t,e,s){if(!(t==="state"&&e!==void 0&&!this.shiftState(e)))for(let o=0;o<this.core.entities().length;o++){let n=this.core.entities()[o];this.isRecordingEntity(n)&&(t==="state"&&e?n.onRecordingStateChanged(e):t==="error"&&s&&n.onRecordingError(s))}}getCapture(){navigator.mediaDevices.getUserMedia({audio:{autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1},video:!1}).then(t=>(this.mediaTracks.push(...t.getAudioTracks()),this.audio.handleStream(t))).then(()=>this.emit("state",h.idle)).catch(t=>this.emit("error",void 0,t))}recordButtonOnStart(){this.emit("state",h.starting)}recordButtonOnStop(){this.emit("state",h.closing)}recordButtonOnReload(){for(let t=0;t<this.mediaTracks.length;t++)this.mediaTracks[t].stop();this.mediaTracks.length=0,this.emit("state",h.noDevice)}recordButtonOnRequest(){this.emit("state",h.requestingDevice)}};var q=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i));for(;i--;){let s=e[i]&63;s<36?t+=s.toString(36):s<62?t+=(s-26).toString(36).toUpperCase():s<63?t+="_":t+="-"}return t};var v;(function(i){i[i.notStarted=0]="notStarted",i[i.playing=1]="playing",i[i.paused=2]="paused"})(v||(v={}));var f;(function(i){i.distortion="distortion",i.compressor="compressor",i.volume="volume",i.lowpass="lowpass",i.speed="speed"})(f||(f={}));var R=class{constructor(t){this.core=t,this.state={}}isSampleEntity(t){return"isSampleEntity"in t&&t.isSampleEntity}emit(t){for(let e=0;e<this.core.entities().length;e++){let s=this.core.entities()[e];this.isSampleEntity(s)&&t(s)}}onSampleSelected(t){this.emit(e=>e.onSampleSelectedChanged(t))}onSampleControlChange(t,e,s){this.emit(o=>o.onSampleNodeValueChange(t,e,s))}onToggleSamplePlaying(t){let e=this.state[t];this.state[t]=this.state[t]===v.notStarted||this.state[t]===v.paused?v.playing:v.paused,this.emit(s=>s.onSampleStateChanged(t,this.state[t],e))}onSampleCreated(t){this.state[t]=v.notStarted;let e=`Sample ${new Date().toUTCString()}`;this.emit(s=>s.onSampleCreated(t,e))}};var S=class{constructor(t,e,s){this.id=t,this.inputNode=e,this.outputNode=s,this.inputConnections={},this.outputConnections={}}isManaged(t){return"isAudioNodeManaged"in t&&t.isAudioNodeManaged&&t.audioNodeManager!==void 0}nodeID(){return this.id}setInput(t){if(this.inputNode)throw Error(`Input node already set for ${this.id}`);this.inputNode=t}setOutput(t){if(this.outputNode)throw Error(`Output node already set for ${this.id}`);this.outputNode=t}input(){if(!this.inputNode)throw Error(`No input node set for ${this.id}`);return this.inputNode}output(){if(!this.outputNode)throw Error(`No output node set for ${this.id}`);return this.outputNode}connectInput(t){if(this.isManaged(t)){if(this.inputConnections[t.audioNodeManager.nodeID()])return;t.audioNodeManager.output().connect(this.input()),this.inputConnections[t.audioNodeManager.nodeID()]=t}else t.connect(this.input())}disconnectInput(t){if(this.isManaged(t)){if(this.inputConnections[t.audioNodeManager.nodeID()])return this.disconnectInputByID(t.audioNodeManager.nodeID());t.audioNodeManager.output().disconnect(this.input())}else t.disconnect(this.input())}disconnectInputByID(t){if(this.inputConnections[t]){let e=this.inputConnections[t];delete this.inputConnections[t],this.disconnectInput(e)}}connectOutput(t){if(this.isManaged(t)){if(this.outputConnections[t.audioNodeManager.nodeID()])return;this.output().connect(t.audioNodeManager.input()),this.outputConnections[t.audioNodeManager.nodeID()]=t}else this.output().connect(t)}disconnectOutput(t){if(this.isManaged(t)){if(this.outputConnections[t.audioNodeManager.nodeID()])return this.disconnectOutputByID(t.audioNodeManager.nodeID());this.output().disconnect(t.audioNodeManager.input())}else this.output().disconnect(t)}disconnectOutputByID(t){if(this.outputConnections[t]){let e=this.outputConnections[t];delete this.outputConnections[t],this.disconnectOutput(e)}}};var V=class{constructor(t,e,s,o){this.id=t,this.core=e,this.math=s,this.audioNodeManager=new S(t),this.isAudioNodeManaged=!0,this.isSampleEntity=!0;let n=this.core.context().createBuffer(1,o.length,this.core.context().sampleRate);this.bufferNode=this.core.context().createBufferSource(),n.copyToChannel(o,0),this.bufferNode.buffer=n,this.bufferNode.loop=!0,this.volumeNode=this.core.context().createGain(),this.volumeNode.gain.setValueAtTime(this.math.exponentialValueInRange(500001,0,3),this.core.context().currentTime),this.audioNodeManager.setOutput(this.volumeNode),this.lowpassFilterNode=this.core.context().createBiquadFilter(),this.lowpassFilterNode.frequency.value=6e3,this.lowpassFilterNode.type="lowpass",this.lowpassFilterNode.connect(this.volumeNode),this.distortionFilterNode=this.core.context().createWaveShaper(),this.distortionFilterNode.oversample="4x",this.distortionCurveData=new Float32Array(this.core.context().sampleRate),this.curve(0),this.distortionFilterNode.curve=this.distortionCurveData,this.distortionFilterNode.connect(this.lowpassFilterNode),this.compressorGainNode=this.core.context().createGain(),this.compressorGainNode.gain.setValueAtTime(-1,this.core.context().currentTime),this.compressorFilterNode=this.core.context().createDynamicsCompressor(),this.compressorGainNode.connect(this.compressorFilterNode),this.compressorFilterNode.threshold.setValueAtTime(-10,this.core.context().currentTime),this.compressorFilterNode.knee.setValueAtTime(4,this.core.context().currentTime),this.compressorFilterNode.ratio.setValueAtTime(2,this.core.context().currentTime),this.compressorFilterNode.attack.setValueAtTime(0,this.core.context().currentTime),this.compressorFilterNode.release.setValueAtTime(.1,this.core.context().currentTime),this.compressorFilterNode.connect(this.distortionFilterNode)}curve(t){let e=typeof t=="number"?~~t:50,s=Math.PI/180,o=0;for(let n=0;n<this.core.context().sampleRate;++n)o=n*2/this.core.context().sampleRate-1,this.distortionCurveData[n]=(10+e)*o*50*s/(Math.PI+e*Math.abs(o))}ramp(t,e,s){t.linearRampToValueAtTime(e,s)}rampTime(){return this.core.context().currentTime+.5}setCompressor(t){this.ramp(this.compressorGainNode.gain,this.math.exponentialValueInRange(t,-1,-1),this.rampTime()),this.ramp(this.compressorFilterNode.threshold,0-this.math.exponentialValueInRange(t,10,100),this.rampTime()),this.ramp(this.compressorFilterNode.knee,this.math.exponentialValueInRange(t,4,40),this.rampTime()),this.ramp(this.compressorFilterNode.ratio,this.math.exponentialValueInRange(t,2,20),this.rampTime()),this.ramp(this.compressorFilterNode.release,Math.pow(20,-1*this.math.exponentialValueInRange(t,1,1e3)),this.rampTime())}setDistortion(t){this.curve(this.math.exponentialValueInRange(t,0,1e4)),this.distortionFilterNode.curve=this.distortionCurveData}setLowpass(t){this.ramp(this.lowpassFilterNode.frequency,6e3-this.math.exponentialValueInRange(t,0,5950*.005)*200,this.rampTime())}setSpeed(t){this.ramp(this.bufferNode.playbackRate,this.math.exponentialValueInRange(t,.1,3),this.rampTime())}setVolume(t){this.ramp(this.volumeNode.gain,this.math.exponentialValueInRange(t,0,3),this.rampTime())}onSampleStateChanged(t,e,s){if(t===this.id)switch(e){case v.playing:s===v.notStarted&&this.bufferNode.start(),this.bufferNode.connect(this.compressorGainNode);break;case v.paused:this.bufferNode.disconnect(this.compressorGainNode);break}}onSampleError(t){}onSampleNodeValueChange(t,e,s){if(t===this.id)switch(e){case f.compressor:this.setCompressor(s);break;case f.distortion:this.setDistortion(s);break;case f.lowpass:this.setLowpass(s);break;case f.speed:this.setSpeed(s);break;case f.volume:this.setVolume(s);break}}onSampleSelectedChanged(){}onSampleCreated(){}};var A=class{constructor(t){let e=window.AudioContext||window.webkitAudioContext;this._context=new e,this._context.suspend(),this.isAudioNodeManaged=!0,this.audioNodeManager=new S(t),this.audioNodeManager.setInput(this._context.destination)}context(){return this._context}onError(){this._context.suspend()}async reloadContext(){this._context.resume()}async handleStream(t){this._context.resume(),this.sourceNode=this._context.createMediaStreamSource(t),this.audioNodeManager.setOutput(this.sourceNode)}getRecorderNode(){return this}};var U=class{logRange(t,e,s,o){if(s<=e)return e;let n=1,r=1000001,a=e<0&&s<0,c=a?e*-1+1:e<=0?-1*e+1:e+1,p=a?s*-1+1:e<=0?s+c:s+1,u=Math.log(c),m=(Math.log(p)-u)/(r-n);return o?(Math.log(t/(a?-1:1)+(a||e>0?1:c))-u)/m+n:(Math.exp(u+m*(t-n))-(a||e>0?1:c))*(a?-1:1)}getPositionForLogRangeValue(t,e,s){return this.logRange(t,e,s,!0)}exponentialValueInRange(t,e,s){return this.logRange(t,e,s)}};function dt(i){for(var t=i.split(/([#.])/),e="",s="",o=[],n=0;n<t.length;n++){var r=t[n];r==="#"?s=t[++n]:r==="."?o.push(t[++n]):r.length&&(e=r)}return{tag:e||"div",id:s,className:o.join(" ")}}function ut(i,t){var e=dt(i),s=e.tag,o=e.id,n=e.className,r=t?document.createElementNS(t,s):document.createElement(s);return o&&(r.id=o),n&&(t?r.setAttribute("class",n):r.className=n),r}function $(i,t){var e=w(i),s=w(t);return t===s&&s.__redom_view&&(t=s.__redom_view),s.parentNode&&(G(t,s,e),e.removeChild(s)),t}function G(i,t,e){var s=t.__redom_lifecycle;if(z(s)){t.__redom_lifecycle={};return}var o=e;for(t.__redom_mounted&&L(t,"onunmount");o;){var n=o.__redom_lifecycle||{};for(var r in s)n[r]&&(n[r]-=s[r]);z(n)&&(o.__redom_lifecycle=null),o=o.parentNode}}function z(i){if(i==null)return!0;for(var t in i)if(i[t])return!1;return!0}var ct=["onmount","onremount","onunmount"],pt=typeof window!="undefined"&&"ShadowRoot"in window;function l(i,t,e,s){var o=w(i),n=w(t);t===n&&n.__redom_view&&(t=n.__redom_view),t!==n&&(n.__redom_view=t);var r=n.__redom_mounted,a=n.parentNode;return r&&a!==o&&G(t,n,a),e!=null?s?o.replaceChild(n,w(e)):o.insertBefore(n,w(e)):o.appendChild(n),mt(t,n,o,a),t}function L(i,t){t==="onmount"||t==="onremount"?i.__redom_mounted=!0:t==="onunmount"&&(i.__redom_mounted=!1);var e=i.__redom_lifecycle;if(!!e){var s=i.__redom_view,o=0;s&&s[t]&&s[t]();for(var n in e)n&&o++;if(o)for(var r=i.firstChild;r;){var a=r.nextSibling;L(r,t),r=a}}}function mt(i,t,e,s){for(var o=t.__redom_lifecycle||(t.__redom_lifecycle={}),n=e===s,r=!1,a=0,c=ct;a<c.length;a+=1){var p=c[a];n||i!==t&&p in i&&(o[p]=(o[p]||0)+1),o[p]&&(r=!0)}if(!r){t.__redom_lifecycle={};return}var u=e,C=!1;for((n||u&&u.__redom_mounted)&&(L(t,n?"onremount":"onmount"),C=!0);u;){var m=u.parentNode,N=u.__redom_lifecycle||(u.__redom_lifecycle={});for(var b in o)N[b]=(N[b]||0)+o[b];if(C)break;(u.nodeType===Node.DOCUMENT_NODE||pt&&u instanceof ShadowRoot||m&&m.__redom_mounted)&&(L(u,n?"onremount":"onmount"),C=!0),u=m}}function ft(i,t,e){var s=w(i);if(typeof t=="object")for(var o in t)K(s,o,t[o]);else K(s,t,e)}function K(i,t,e){e==null?i.style[t]="":i.style[t]=e}var Q="http://www.w3.org/1999/xlink";function X(i,t,e,s){var o=w(i),n=typeof t=="object";if(n)for(var r in t)X(o,r,t[r],s);else{var a=o instanceof SVGElement,c=typeof e=="function";if(t==="style"&&typeof e=="object")ft(o,e);else if(a&&c)o[t]=e;else if(t==="dataset")Y(o,e);else if(!a&&(t in o||c)&&t!=="list")o[t]=e;else{if(a&&t==="xlink"){J(o,e);return}s&&t==="class"&&(e=o.className+" "+e),e==null?o.removeAttribute(t):o.setAttribute(t,e)}}}function J(i,t,e){if(typeof t=="object")for(var s in t)J(i,s,t[s]);else e!=null?i.setAttributeNS(Q,t,e):i.removeAttributeNS(Q,t,e)}function Y(i,t,e){if(typeof t=="object")for(var s in t)Y(i,s,t[s]);else e!=null?i.dataset[t]=e:delete i.dataset[t]}function vt(i){return document.createTextNode(i??"")}function Z(i,t,e){for(var s=0,o=t;s<o.length;s+=1){var n=o[s];if(!(n!==0&&!n)){var r=typeof n;r==="function"?n(i):r==="string"||r==="number"?i.appendChild(vt(n)):B(w(n))?l(i,n):n.length?Z(i,n,e):r==="object"&&X(i,n,null,e)}}}function gt(i){return typeof i=="string"?E(i):w(i)}function w(i){return i.nodeType&&i||!i.el&&i||w(i.el)}function B(i){return i&&i.nodeType}var tt={};function E(i){for(var t=[],e=arguments.length-1;e-- >0;)t[e]=arguments[e+1];var s,o=typeof i;if(o==="string")s=et(i).cloneNode(!1);else if(B(i))s=i.cloneNode(!1);else if(o==="function"){var n=i;s=new(Function.prototype.bind.apply(n,[null].concat(t)))}else throw new Error("At least one argument required");return Z(w(s),t,!0),s}var d=E;E.extend=function(t){for(var e=[],s=arguments.length-1;s-- >0;)e[s]=arguments[s+1];var o=et(t);return E.bind.apply(E,[this,o].concat(e))};function et(i){return tt[i]||(tt[i]=ut(i))}function k(i){for(var t=[],e=arguments.length-1;e-- >0;)t[e]=arguments[e+1];for(var s=w(i),o=it(i,t,s.firstChild);o;){var n=o.nextSibling;$(i,o),o=n}}function it(i,t,e){for(var s=e,o=new Array(t.length),n=0;n<t.length;n++)o[n]=t[n]&&w(t[n]);for(var r=0;r<t.length;r++){var a=t[r];if(!!a){var c=o[r];if(c===s){s=s.nextSibling;continue}if(B(c)){var p=s&&s.nextSibling,u=a.__redom_index!=null,C=u&&p===o[r+1];l(i,a,s,C),C&&(s=p);continue}a.length!=null&&(s=it(i,a,s))}}return s}var st=function(t,e,s){this.View=t,this.initData=s,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],e!=null&&(this.key=typeof e=="function"?e:wt(e))};st.prototype.update=function(t,e){for(var s=this,o=s.View,n=s.key,r=s.initData,a=n!=null,c=this.lookup,p={},u=new Array(t.length),C=this.views,m=0;m<t.length;m++){var N=t[m],b=void 0;if(a){var M=n(N);b=c[M]||new o(r,N,m,t),p[M]=b,b.__redom_id=M}else b=C[m]||new o(r,N,m,t);b.update&&b.update(N,m,t,e);var lt=w(b.el);lt.__redom_view=b,u[m]=b}this.oldViews=C,this.views=u,this.oldLookup=c,this.lookup=p};function wt(i){return function(t){return t[i]}}var I=function(t,e,s,o){this.View=e,this.initData=o,this.views=[],this.pool=new st(e,s,o),this.el=gt(t),this.keySet=s!=null};I.prototype.update=function(t,e){t===void 0&&(t=[]);var s=this,o=s.keySet,n=this.views;this.pool.update(t,e);var r=this.pool,a=r.views,c=r.lookup;if(o)for(var p=0;p<n.length;p++){var u=n[p],C=u.__redom_id;c[C]==null&&(u.__redom_index=null,$(this,u))}for(var m=0;m<a.length;m++){var N=a[m];N.__redom_index=m}k(this,a),o&&(this.lookup=c),this.views=a};I.extend=function(t,e,s,o){return I.bind(I,t,e,s,o)};var j=class{constructor(t,e){this.id=t,this.handler=e,this.el=d("div.sampleSelect"),this.isSampleEntity=!0,this.handleClick=this.handleClick.bind(this),this.elements={},this.selectedID=void 0}handleClick(t){t!==this.selectedID&&this.handler.onSampleSelected(t)}onSampleStateChanged(t,e){switch(e){case v.paused:this.elements[t].classList.remove("playing");break;case v.playing:this.elements[t].classList.add("playing");break}}onSampleSelectedChanged(t){this.selectedID&&this.elements[this.selectedID].classList.remove("selected"),this.elements[t].classList.add("selected"),this.selectedID=t}onSampleNodeValueChange(){}onSampleError(t){}onSampleCreated(t,e){if(this.elements[t])throw Error(`Select list already contains sample ${t}`);let s=d("div.sampleItem"),o=d("span",e),n=d("p");l(n,o),l(s,n),s.addEventListener("click",r=>{r.preventDefault(),this.handleClick(t)}),this.elements[t]=s,l(this.el,s)}};var ot;(function(i){i[i.idle=0]="idle",i[i.start=1]="start",i[i.holding=2]="holding"})(ot||(ot={}));var y;(function(i){i[i.tap=0]="tap",i[i.hold=1]="hold"})(y||(y={}));var D=class{constructor(t,e,s=0,o){if(this.handler=t,this._stateLabels=e,this.buttonCTA=s,!(o in this._stateLabels))throw Error("Initial state not available state");let n=Object.keys(this._stateLabels).map(a=>a.length).sort().reverse()[0];this.stateLabels=Object.entries(this._stateLabels).reduce((a,[c,p])=>(a[c]=p.padEnd(n),a),{}),this.state=o,this.touchTimeout=0,this.touchState=0,this.touchHold=this.touchHold.bind(this),this.el=d("div",{className:"labelButton",style:{maxWidth:`${Math.min(n,32)}ch`}});let r=d("p");this.label=d("span",this.stateLabels[o]),l(r,this.label),l(this.el,r),this.button=d("button"),this.setButtonText(),l(this.el,this.button),this.onDown=this.onDown.bind(this),this.button.addEventListener("mousedown",this.onDown),this.touchStart=this.touchStart.bind(this),this.button.addEventListener("touchstart",this.touchStart),this.touchEnd=this.touchEnd.bind(this),this.button.addEventListener("touchend",this.touchEnd),this.onUp=this.onUp.bind(this),this.button.addEventListener("mouseup",this.onUp),this.onClick=this.onClick.bind(this),this.button.addEventListener("click",this.onClick),this.onLeave=this.onLeave.bind(this),this.button.addEventListener("mouseleave",this.onLeave)}setButtonText(t){switch(t!==void 0&&(this.buttonCTA=t),this.buttonCTA){case 0:this.button.textContent="Tap here";break;case 1:this.button.textContent="Hold here";break}}touchEnd(t){t.preventDefault(),t.stopPropagation(),clearTimeout(this.touchTimeout),this.touchState===2&&this.buttonCTA===1?this.onUp():(this.touchState=0,this.onClick())}touchHold(){this.onDown()}touchStart(t){t.preventDefault(),t.stopPropagation(),this.touchState===0&&(this.touchState=1,this.touchTimeout=window.setTimeout(this.touchHold,100))}onUp(t){t?.preventDefault(),this.touchState=0,this.el.classList.remove("down"),this.buttonCTA!==0&&this.handler.onUp?.(this.state)}onClick(t){t?.preventDefault(),this.buttonCTA===0&&this.handler.onClick?.(this.state)}onDown(t){t?.preventDefault(),this.touchState=2,this.el.classList.add("down"),this.buttonCTA!==0&&this.handler.onDown?.(this.state)}onLeave(t){t?.preventDefault(),this.touchState===2&&this.el.classList.remove("down"),this.buttonCTA===1&&this.handler.onLeave?.(this.state)}setState(t){if(!(t in this.stateLabels))throw Error("Setting unavailable button state");this.state=t,this.label.textContent=this.stateLabels[this.state]}setCTA(t){this.setButtonText(t)}enable(){this.button.disabled=!1}disable(){this.button.disabled=!0}};var x;(function(i){i.paused="Play sample",i.playing="Pause sample"})(x||(x={}));var O=class{constructor(t,e){this.sampleID=t,this.handler=e,this.el=new D(this,Object.values(x).reduce((s,o)=>Object.assign(s,{[o]:o}),{}),y.tap,x.paused),this.onClick=this.onClick.bind(this)}onClick(){this.handler.onToggleSamplePlaying(this.sampleID)}onStateChange(t){switch(t){case v.paused:this.el.setState(x.paused);break;case v.playing:this.el.setState(x.playing);break}}};var nt;(function(i){i[i.locked=0]="locked",i[i.idle=1]="idle",i[i.down=2]="down",i[i.released=3]="released"})(nt||(nt={}));var rt;(function(i){i[i.down=-1]="down",i[i.up=1]="up"})(rt||(rt={}));var _=class{constructor(t,e,s,o,n=1){this.id=t,this.type=e,this.handler=s,this.value=n,this.el=d("div.rangeChange");let r=d("p");this.labelEl=d("span",o),l(r,this.labelEl),l(this.el,r),this.numberEl=d("div",{className:"rangeValue"},`${n}`),l(this.el,this.numberEl);let a=d("div.rangeBtns");this.decBtn=d("button","Less"),this.incBtn=d("button","More"),k(a,[this.decBtn,this.incBtn]),l(this.el,a),this.interval=0,this.increment=1e4,this.maxValue=1000001,this.minValue=1,this.state=1,this.onDown=this.onDown.bind(this),this.onUp=this.onUp.bind(this),this.handleUp=this.handleUp.bind(this),this.setValue=this.setValue.bind(this),this.setButtonEvents(this.decBtn,-1),this.setButtonEvents(this.incBtn,1)}handleUp(){window.removeEventListener("mouseup",this.handleUp),window.removeEventListener("touchend",this.handleUp),this.onUp()}setButtonEvents(t,e){t.addEventListener("mousedown",s=>{s.preventDefault(),window.addEventListener("mouseup",this.handleUp),window.addEventListener("touchend",this.handleUp),this.onDown(e)}),t.addEventListener("touchstart",s=>{s.preventDefault(),window.addEventListener("mouseup",this.handleUp),window.addEventListener("touchend",this.handleUp),this.onDown(e)})}onDown(t){this.state===1&&(this.state=2,this.interval=window.setInterval(()=>{this.handler.onUIRangeChange(this.type,Math.max(Math.min(this.value+(Math.random()*(t*(this.increment-1e3))+1e3),this.maxValue),this.minValue))},30))}onUp(){this.state=1,clearInterval(this.interval)}setValue(t){this.value=t,this.numberEl.textContent=`${t}`}};var at;(function(i){i[i.visible=0]="visible",i[i.hidden=1]="hidden"})(at||(at={}));var F=class{constructor(t,e,s,o,n,r){this.id=t,this.sampleID=e,this.handler=s,this.el=d("div.hidden"),this.isSampleEntity=!0;let a=d("p.sampleLabel");this.labelEl=d("span",o),l(a,this.labelEl),l(this.el,a),this.playBtn=new O(e,this.handler),this.playBtn.el.el.classList.add("playBtn"),this.volumeCtrl=new _(n.createID(),f.volume,this,"Volume",500001),n.addEntity(this.volumeCtrl),this.lowpassCtrl=new _(n.createID(),f.lowpass,this,"Filter"),n.addEntity(this.lowpassCtrl),this.distortionCtrl=new _(n.createID(),f.distortion,this,"Distortion"),n.addEntity(this.distortionCtrl),this.compressorCtrl=new _(n.createID(),f.compressor,this,"Compressor"),n.addEntity(this.compressorCtrl),this.speedCtrl=new _(n.createID(),f.speed,this,"Speed",r.getPositionForLogRangeValue(1,.1,3)),n.addEntity(this.speedCtrl),l(this.el,this.playBtn),l(this.el,this.compressorCtrl),l(this.el,this.distortionCtrl),l(this.el,this.lowpassCtrl),l(this.el,this.volumeCtrl),l(this.el,this.speedCtrl),this.state=1}show(){this.state!==0&&(this.state=0,this.el.classList.remove("hidden"))}hide(){this.state!==1&&(this.state=1,this.el.classList.add("hidden"))}onUIRangeChange(t,e){this.handler.onSampleControlChange(this.sampleID,t,e)}onSampleStateChanged(t,e){t===this.sampleID&&this.playBtn.onStateChange(e)}onSampleNodeValueChange(t,e,s){if(t===this.sampleID)switch(e){case f.compressor:this.compressorCtrl.setValue(s);break;case f.distortion:this.distortionCtrl.setValue(s);break;case f.lowpass:this.lowpassCtrl.setValue(s);break;case f.speed:this.speedCtrl.setValue(s);break;case f.volume:this.volumeCtrl.setValue(s);break}}onSampleSelectedChanged(t){this.state===0&&this.sampleID!==t&&this.hide(),this.state===1&&this.sampleID===t&&this.show()}onSampleError(t){}onSampleCreated(){}};var g;(function(i){i.error="Reload context",i.noDevice="Enable input device",i.requestingDevice="Loading...",i.idle="Hold down to record",i.stopRecording="Stopping...",i.recording="Release to stop recording",i.startRecording="Starting..."})(g||(g={}));var P=class{constructor(t,e,s){this.id=t,this.handler=e,this.recordLength=s,this.el=new D(this,Object.values(g).reduce((o,n)=>Object.assign(o,{[n]:n}),{}),y.tap,g.noDevice),this.isRecordingEntity=!0,this.stopRecording=this.stopRecording.bind(this),this.onDown=this.onDown.bind(this),this.onUp=this.onUp.bind(this),this.onLeave=this.onLeave.bind(this),this.onClick=this.onClick.bind(this),this.recordingTimeout=0}stopRecording(){clearTimeout(this.recordingTimeout),this.handler.recordButtonOnStop()}onDown(t){t===g.idle&&this.handler.recordButtonOnStart()}onUp(t){t===g.recording&&this.stopRecording()}onLeave(t){t===g.recording&&this.stopRecording()}onClick(t){switch(t){case g.error:this.handler.recordButtonOnReload();break;case g.noDevice:this.handler.recordButtonOnRequest();break;default:break}}onRecordingStateChanged(t){switch(t){case h.starting:this.el.disable(),this.el.setState(g.startRecording);break;case h.recording:this.el.setState(g.recording),this.el.enable(),this.recordingTimeout=window.setTimeout(this.stopRecording,this.recordLength*1e3);break;case h.closing:this.el.disable(),this.el.setState(g.stopRecording);break;case h.idle:this.el.setState(g.idle),this.el.enable(),this.el.setCTA(y.hold);break;case h.noDevice:this.el.setState(g.noDevice),this.el.setCTA(y.tap);break;case h.error:this.el.setState(g.error);break;case h.requestingDevice:this.el.disable(),this.el.setState(g.requestingDevice);break}}onRecordingError(){this.el.setState(g.error)}};var H=class{constructor(t,e,s,o,n,r,a,c){this.id=t,this.handler=e,this.sampleHandler=s,this.mathUtility=o;let p=this.getElOrThrow(n);this.addStylesheet(c);let u=d("div.schallvernichtung");this.baseEl=d("div.base"),l(p,u),l(u,this.baseEl),this.sampleBlocks=[],this.samplesMount=d("div.samplesMount"),this.sampleList=new j(this.handler.createID(),s),this.handler.addEntity(this.sampleList),this.recordBtn=new P(this.handler.createID(),r,a),this.handler.addEntity(this.recordBtn),this.isSampleEntity=!0,this.setUI()}addStylesheet(t){let e=this.getElOrThrow("head"),s=d("link",{type:"text/css",rel:"stylesheet",href:t});e.appendChild(s)}getElOrThrow(t){let e=document.querySelector(t);if(!e)throw Error(`Couldn't find element ${t}`);return e}wrap(t,e,s){let o=d(`div${s?`.${s}`:""}`);if(e){let n=d("p",e);l(o,n)}return Array.isArray(t)?k(o,t):l(o,t),o}setUI(){l(this.baseEl,this.wrap([this.recordBtn],void 0,"topLevel")),l(this.baseEl,this.wrap([this.samplesMount,this.sampleList],void 0,"sampleManager"))}onSampleCreated(t,e){let s=new F(this.handler.createID(),t,this.sampleHandler,e,this.handler,this.mathUtility);this.handler.addEntity(s),this.sampleBlocks.push(s),l(this.samplesMount,s)}onSampleStateChanged(t,e,s){}onSampleSelectedChanged(t){this.baseEl.scrollTo(0,0)}onSampleNodeValueChange(){}onSampleError(t){}};var ht=class{constructor(t,e,s){let o=10,n=4096;this.contextNodeID="context",this.contextNode=new A(this.contextNodeID),this._entities=[],this.recordingHandler=new T(this,this.contextNode,e,n,o),this.sampleHandler=new R(this),this.mathUtility=new U,this.ui=new H(this.createID(),this,this.sampleHandler,this.mathUtility,t,this.recordingHandler,o,s),this.addEntity(this.ui)}addEntity(t){this._entities.push(t)}createID(){return q(10)}entities(){return this._entities}onRecorded(t){if(t.length<this.contextNode.context().sampleRate*.2)return;let e=this.createID(),s=new V(e,this.contextNode,this.mathUtility,t);this.addEntity(s),s.audioNodeManager.connectOutput(this.contextNode),this.sampleHandler.onSampleCreated(e)}};export{ht as Schallvernichtung};
