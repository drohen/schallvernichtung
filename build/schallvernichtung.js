var q={MODE:"production",NODE_ENV:"production",SSR:!1};var a;(function(i){i[i.noDevice=0]="noDevice",i[i.requestingDevice=1]="requestingDevice",i[i.idle=2]="idle",i[i.starting=3]="starting",i[i.ready=4]="ready",i[i.recording=5]="recording",i[i.closing=6]="closing",i[i.error=7]="error"})(a||(a={}));import.meta.env=q;var M=class{constructor(t,e,s,o,n){this.core=t,this.audio=e,this.workerPath=s,this.chunkSize=o,this.recordLength=n,this.mediaTracks=[],this.state=a.noDevice,this.handleRecorderMessage=this.handleRecorderMessage.bind(this),this.audio.context().audioWorklet?this.audio.context().audioWorklet.addModule(this.workerPath).catch(r=>this.emit("error",void 0,r)):(this.recorderNode=this.audio.context().createScriptProcessor(this.chunkSize,1,1),this.processChunk=this.processChunk.bind(this),this.recorderNode.addEventListener("audioprocess",this.processChunk),this.recorderNode.connect(this.audio.context().destination))}setRecorder(){if(this.audio.context().audioWorklet){if(this.recorderNode=new AudioWorkletNode(this.audio.context(),"recording-worklet",{numberOfOutputs:0,numberOfInputs:1}),!this.recorderNode)throw Error("No recording node available to connect");this.audio.getRecorderNode().audioNodeManager.connectOutput(this.recorderNode),this.recorder=this.recorderNode.port}else this.recorder=new Worker(new URL(this.workerPath,import.meta.url),{name:"recording-worker",type:"module"});this.recorder.onmessage=this.handleRecorderMessage,this.postRecorder({command:"init",data:{chunkSize:this.chunkSize,maxLength:this.recordLength,sampleRate:this.audio.context().sampleRate}})}unsetRecorder(){if(this.audio.context().audioWorklet){if(!this.recorderNode)throw Error("No recording node available to disconnect");this.audio.getRecorderNode().audioNodeManager.disconnectOutput(this.recorderNode)}this.recorder=void 0}handleRecorderMessage(t){switch(t.data.message){case"ready":this.emit("state",a.ready);break;case"recording":this.emit("state",a.recording);break;case"done":this.unsetRecorder(),this.emit("state",a.idle),this.core.onRecorded(t.data.buffer);break}}processChunk(t){this.postRecorder({command:"chunk",buffer:t.inputBuffer.getChannelData(0)})}isRecordingEntity(t){return"isRecordingEntity"in t&&t.isRecordingEntity}postRecorder(t){this.recorder?.postMessage(t)}shiftState(t){if(t===this.state)return!1;switch(t){case a.closing:return this.state!==a.recording?!1:(this.state=a.closing,this.postRecorder({command:"stop"}),!0);case a.error:return this.state=a.error,!0;case a.idle:return this.state!==a.closing&&this.state!==a.requestingDevice?!1:(this.state=a.idle,!0);case a.noDevice:return this.state!==a.error?!1:(this.state=a.noDevice,!0);case a.recording:return this.state!==a.ready?!1:(this.state=a.recording,!0);case a.requestingDevice:return this.state!==a.noDevice?!1:(this.state=a.requestingDevice,this.getCapture(),!0);case a.ready:return this.state!==a.starting?!1:(this.state=a.ready,this.postRecorder({command:"start"}),!0);case a.starting:return this.state!==a.idle?!1:(this.state=a.starting,this.setRecorder(),!0)}}emit(t,e,s){if(!(t==="state"&&e!==void 0&&!this.shiftState(e)))for(let o=0;o<this.core.entities().length;o++){let n=this.core.entities()[o];this.isRecordingEntity(n)&&(t==="state"&&e?n.onRecordingStateChanged(e):t==="error"&&s&&n.onRecordingError(s))}}getCapture(){navigator.mediaDevices.getUserMedia({audio:{autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1},video:!1}).then(t=>(this.mediaTracks.push(...t.getAudioTracks()),this.audio.handleStream(t))).then(()=>this.emit("state",a.idle)).catch(t=>this.emit("error",void 0,t))}recordButtonOnStart(){this.emit("state",a.starting)}recordButtonOnStop(){this.emit("state",a.closing)}recordButtonOnReload(){for(let t=0;t<this.mediaTracks.length;t++)this.mediaTracks[t].stop();this.mediaTracks.length=0,this.emit("state",a.noDevice)}recordButtonOnRequest(){this.emit("state",a.requestingDevice)}};var W=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i));for(;i--;){let s=e[i]&63;s<36?t+=s.toString(36):s<62?t+=(s-26).toString(36).toUpperCase():s<63?t+="_":t+="-"}return t};var v;(function(i){i[i.notStarted=0]="notStarted",i[i.playing=1]="playing",i[i.paused=2]="paused"})(v||(v={}));var f;(function(i){i.distortion="distortion",i.compressor="compressor",i.volume="volume",i.lowpass="lowpass",i.speed="speed"})(f||(f={}));var I=class{constructor(t){this.core=t,this.state={}}isSampleEntity(t){return"isSampleEntity"in t&&t.isSampleEntity}emit(t){for(let e=0;e<this.core.entities().length;e++){let s=this.core.entities()[e];this.isSampleEntity(s)&&t(s)}}onSampleSelected(t){this.emit(e=>e.onSampleSelectedChanged(t))}onSampleControlChange(t,e,s){this.emit(o=>o.onSampleNodeValueChange(t,e,s))}onToggleSamplePlaying(t){let e=this.state[t];this.state[t]=this.state[t]===v.notStarted||this.state[t]===v.paused?v.playing:v.paused,this.emit(s=>s.onSampleStateChanged(t,this.state[t],e))}onSampleCreated(t){this.state[t]=v.notStarted,this.emit(e=>e.onSampleCreated(t))}};var y=class{constructor(t,e,s){this.id=t,this.inputNode=e,this.outputNode=s,this.inputConnections={},this.outputConnections={}}isManaged(t){return"isAudioNodeManaged"in t&&t.isAudioNodeManaged&&t.audioNodeManager!==void 0}nodeID(){return this.id}setInput(t){if(this.inputNode)throw Error(`Input node already set for ${this.id}`);this.inputNode=t}setOutput(t){if(this.outputNode)throw Error(`Output node already set for ${this.id}`);this.outputNode=t}input(){if(!this.inputNode)throw Error(`No input node set for ${this.id}`);return this.inputNode}output(){if(!this.outputNode)throw Error(`No output node set for ${this.id}`);return this.outputNode}connectInput(t){if(this.isManaged(t)){if(this.inputConnections[t.audioNodeManager.nodeID()])return;t.audioNodeManager.output().connect(this.input()),this.inputConnections[t.audioNodeManager.nodeID()]=t}else t.connect(this.input())}disconnectInput(t){if(this.isManaged(t)){if(this.inputConnections[t.audioNodeManager.nodeID()])return this.disconnectInputByID(t.audioNodeManager.nodeID());t.audioNodeManager.output().disconnect(this.input())}else t.disconnect(this.input())}disconnectInputByID(t){if(this.inputConnections[t]){let e=this.inputConnections[t];delete this.inputConnections[t],this.disconnectInput(e)}}connectOutput(t){if(this.isManaged(t)){if(this.outputConnections[t.audioNodeManager.nodeID()])return;this.output().connect(t.audioNodeManager.input()),this.outputConnections[t.audioNodeManager.nodeID()]=t}else this.output().connect(t)}disconnectOutput(t){if(this.isManaged(t)){if(this.outputConnections[t.audioNodeManager.nodeID()])return this.disconnectOutputByID(t.audioNodeManager.nodeID());this.output().disconnect(t.audioNodeManager.input())}else this.output().disconnect(t)}disconnectOutputByID(t){if(this.outputConnections[t]){let e=this.outputConnections[t];delete this.outputConnections[t],this.disconnectOutput(e)}}};var A=class{constructor(t,e,s,o){this.id=t,this.core=e,this.math=s,this.audioNodeManager=new y(t),this.isAudioNodeManaged=!0,this.isSampleEntity=!0;let n=this.core.context().createBuffer(1,o.length,this.core.context().sampleRate);this.bufferNode=this.core.context().createBufferSource(),n.copyToChannel(o,0),this.bufferNode.buffer=n,this.bufferNode.loop=!0,this.volumeNode=this.core.context().createGain(),this.volumeNode.gain.setValueAtTime(this.math.exponentialValueInRange(51,0,3),this.core.context().currentTime),this.audioNodeManager.setOutput(this.volumeNode),this.lowpassFilterNode=this.core.context().createBiquadFilter(),this.lowpassFilterNode.frequency.value=6e3,this.lowpassFilterNode.type="lowpass",this.lowpassFilterNode.connect(this.volumeNode),this.distortionFilterNode=this.core.context().createWaveShaper(),this.distortionFilterNode.oversample="4x",this.distortionCurveData=new Float32Array(this.core.context().sampleRate),this.curve(0),this.distortionFilterNode.curve=this.distortionCurveData,this.distortionFilterNode.connect(this.lowpassFilterNode),this.compressorGainNode=this.core.context().createGain(),this.compressorGainNode.gain.setValueAtTime(-1,this.core.context().currentTime),this.compressorFilterNode=this.core.context().createDynamicsCompressor(),this.compressorGainNode.connect(this.compressorFilterNode),this.compressorFilterNode.threshold.setValueAtTime(-10,this.core.context().currentTime),this.compressorFilterNode.knee.setValueAtTime(4,this.core.context().currentTime),this.compressorFilterNode.ratio.setValueAtTime(2,this.core.context().currentTime),this.compressorFilterNode.attack.setValueAtTime(0,this.core.context().currentTime),this.compressorFilterNode.release.setValueAtTime(.1,this.core.context().currentTime),this.compressorFilterNode.connect(this.distortionFilterNode)}curve(t){let e=typeof t=="number"?~~t:50,s=Math.PI/180,o=0;for(let n=0;n<this.core.context().sampleRate;++n)o=n*2/this.core.context().sampleRate-1,this.distortionCurveData[n]=(10+e)*o*50*s/(Math.PI+e*Math.abs(o))}ramp(t,e,s){t.linearRampToValueAtTime(e,s)}rampTime(){return this.core.context().currentTime+.5}setCompressor(t){this.ramp(this.compressorGainNode.gain,this.math.exponentialValueInRange(t,-1,-1),this.rampTime()),this.ramp(this.compressorFilterNode.threshold,0-this.math.exponentialValueInRange(t,10,100),this.rampTime()),this.ramp(this.compressorFilterNode.knee,this.math.exponentialValueInRange(t,4,40),this.rampTime()),this.ramp(this.compressorFilterNode.ratio,this.math.exponentialValueInRange(t,2,20),this.rampTime()),this.ramp(this.compressorFilterNode.release,Math.pow(20,-1*this.math.exponentialValueInRange(t,1,1e3)),this.rampTime())}setDistortion(t){this.curve(this.math.exponentialValueInRange(t,0,1e4)),this.distortionFilterNode.curve=this.distortionCurveData}setLowpass(t){this.ramp(this.lowpassFilterNode.frequency,6e3-this.math.exponentialValueInRange(t,0,5950*.005)*200,this.rampTime())}setSpeed(t){this.ramp(this.bufferNode.playbackRate,this.math.exponentialValueInRange(t,.1,3),this.rampTime())}setVolume(t){this.ramp(this.volumeNode.gain,this.math.exponentialValueInRange(t,0,3),this.rampTime())}onSampleStateChanged(t,e,s){if(t===this.id)switch(e){case v.playing:s===v.notStarted&&this.bufferNode.start(),this.bufferNode.connect(this.compressorGainNode);break;case v.paused:this.bufferNode.disconnect(this.compressorGainNode);break}}onSampleError(t){}onSampleNodeValueChange(t,e,s){if(t===this.id)switch(e){case f.compressor:this.setCompressor(s);break;case f.distortion:this.setDistortion(s);break;case f.lowpass:this.setLowpass(s);break;case f.speed:this.setSpeed(s);break;case f.volume:this.setVolume(s);break}}onSampleSelectedChanged(){}onSampleCreated(){}};var j=class{constructor(t){let e=window.AudioContext||window.webkitAudioContext;this._context=new e,this._context.suspend(),this.isAudioNodeManaged=!0,this.audioNodeManager=new y(t),this.audioNodeManager.setInput(this._context.destination)}context(){return this._context}onError(){this._context.suspend()}async reloadContext(){this._context.resume()}async handleStream(t){this._context.resume(),this.sourceNode=this._context.createMediaStreamSource(t),this.audioNodeManager.setOutput(this.sourceNode)}getRecorderNode(){return this}};var O=class{logRange(t,e,s,o){if(s<=e)return e;let n=1,r=101,h=e<0&&s<0,c=h?e*-1+1:e<=0?-1*e+1:e+1,p=h?s*-1+1:e<=0?s+c:s+1,d=Math.log(c),m=(Math.log(p)-d)/(r-n);return o?(Math.log(t/(h?-1:1)+(h||e>0?1:c))-d)/m+n:(Math.exp(d+m*(t-n))-(h||e>0?1:c))*(h?-1:1)}getPositionForLogRangeValue(t,e,s){return this.logRange(t,e,s,!0)}exponentialValueInRange(t,e,s){return this.logRange(t,e,s)}};function ht(i){for(var t=i.split(/([#.])/),e="",s="",o=[],n=0;n<t.length;n++){var r=t[n];r==="#"?s=t[++n]:r==="."?o.push(t[++n]):r.length&&(e=r)}return{tag:e||"div",id:s,className:o.join(" ")}}function lt(i,t){var e=ht(i),s=e.tag,o=e.id,n=e.className,r=t?document.createElementNS(t,s):document.createElement(s);return o&&(r.id=o),n&&(t?r.setAttribute("class",n):r.className=n),r}function $(i,t){var e=b(i),s=b(t);return t===s&&s.__redom_view&&(t=s.__redom_view),s.parentNode&&(G(t,s,e),e.removeChild(s)),t}function G(i,t,e){var s=t.__redom_lifecycle;if(z(s)){t.__redom_lifecycle={};return}var o=e;for(t.__redom_mounted&&D(t,"onunmount");o;){var n=o.__redom_lifecycle||{};for(var r in s)n[r]&&(n[r]-=s[r]);z(n)&&(o.__redom_lifecycle=null),o=o.parentNode}}function z(i){if(i==null)return!0;for(var t in i)if(i[t])return!1;return!0}var dt=["onmount","onremount","onunmount"],ct=typeof window!="undefined"&&"ShadowRoot"in window;function l(i,t,e,s){var o=b(i),n=b(t);t===n&&n.__redom_view&&(t=n.__redom_view),t!==n&&(n.__redom_view=t);var r=n.__redom_mounted,h=n.parentNode;return r&&h!==o&&G(t,n,h),e!=null?s?o.replaceChild(n,b(e)):o.insertBefore(n,b(e)):o.appendChild(n),ut(t,n,o,h),t}function D(i,t){t==="onmount"||t==="onremount"?i.__redom_mounted=!0:t==="onunmount"&&(i.__redom_mounted=!1);var e=i.__redom_lifecycle;if(!!e){var s=i.__redom_view,o=0;s&&s[t]&&s[t]();for(var n in e)n&&o++;if(o)for(var r=i.firstChild;r;){var h=r.nextSibling;D(r,t),r=h}}}function ut(i,t,e,s){for(var o=t.__redom_lifecycle||(t.__redom_lifecycle={}),n=e===s,r=!1,h=0,c=dt;h<c.length;h+=1){var p=c[h];n||i!==t&&p in i&&(o[p]=(o[p]||0)+1),o[p]&&(r=!0)}if(!r){t.__redom_lifecycle={};return}var d=e,C=!1;for((n||d&&d.__redom_mounted)&&(D(t,n?"onremount":"onmount"),C=!0);d;){var m=d.parentNode,N=d.__redom_lifecycle||(d.__redom_lifecycle={});for(var w in o)N[w]=(N[w]||0)+o[w];if(C)break;(d.nodeType===Node.DOCUMENT_NODE||ct&&d instanceof ShadowRoot||m&&m.__redom_mounted)&&(D(d,n?"onremount":"onmount"),C=!0),d=m}}function pt(i,t,e){var s=b(i);if(typeof t=="object")for(var o in t)K(s,o,t[o]);else K(s,t,e)}function K(i,t,e){e==null?i.style[t]="":i.style[t]=e}var Q="http://www.w3.org/1999/xlink";function X(i,t,e,s){var o=b(i),n=typeof t=="object";if(n)for(var r in t)X(o,r,t[r],s);else{var h=o instanceof SVGElement,c=typeof e=="function";if(t==="style"&&typeof e=="object")pt(o,e);else if(h&&c)o[t]=e;else if(t==="dataset")Y(o,e);else if(!h&&(t in o||c)&&t!=="list")o[t]=e;else{if(h&&t==="xlink"){J(o,e);return}s&&t==="class"&&(e=o.className+" "+e),e==null?o.removeAttribute(t):o.setAttribute(t,e)}}}function J(i,t,e){if(typeof t=="object")for(var s in t)J(i,s,t[s]);else e!=null?i.setAttributeNS(Q,t,e):i.removeAttributeNS(Q,t,e)}function Y(i,t,e){if(typeof t=="object")for(var s in t)Y(i,s,t[s]);else e!=null?i.dataset[t]=e:delete i.dataset[t]}function mt(i){return document.createTextNode(i??"")}function Z(i,t,e){for(var s=0,o=t;s<o.length;s+=1){var n=o[s];if(!(n!==0&&!n)){var r=typeof n;r==="function"?n(i):r==="string"||r==="number"?i.appendChild(mt(n)):V(b(n))?l(i,n):n.length?Z(i,n,e):r==="object"&&X(i,n,null,e)}}}function ft(i){return typeof i=="string"?k(i):b(i)}function b(i){return i.nodeType&&i||!i.el&&i||b(i.el)}function V(i){return i&&i.nodeType}var tt={};function k(i){for(var t=[],e=arguments.length-1;e-- >0;)t[e]=arguments[e+1];var s,o=typeof i;if(o==="string")s=et(i).cloneNode(!1);else if(V(i))s=i.cloneNode(!1);else if(o==="function"){var n=i;s=new(Function.prototype.bind.apply(n,[null].concat(t)))}else throw new Error("At least one argument required");return Z(b(s),t,!0),s}var u=k;k.extend=function(t){for(var e=[],s=arguments.length-1;s-- >0;)e[s]=arguments[s+1];var o=et(t);return k.bind.apply(k,[this,o].concat(e))};function et(i){return tt[i]||(tt[i]=lt(i))}function R(i){for(var t=[],e=arguments.length-1;e-- >0;)t[e]=arguments[e+1];for(var s=b(i),o=it(i,t,s.firstChild);o;){var n=o.nextSibling;$(i,o),o=n}}function it(i,t,e){for(var s=e,o=new Array(t.length),n=0;n<t.length;n++)o[n]=t[n]&&b(t[n]);for(var r=0;r<t.length;r++){var h=t[r];if(!!h){var c=o[r];if(c===s){s=s.nextSibling;continue}if(V(c)){var p=s&&s.nextSibling,d=h.__redom_index!=null,C=d&&p===o[r+1];l(i,h,s,C),C&&(s=p);continue}h.length!=null&&(s=it(i,h,s))}}return s}var st=function(t,e,s){this.View=t,this.initData=s,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],e!=null&&(this.key=typeof e=="function"?e:vt(e))};st.prototype.update=function(t,e){for(var s=this,o=s.View,n=s.key,r=s.initData,h=n!=null,c=this.lookup,p={},d=new Array(t.length),C=this.views,m=0;m<t.length;m++){var N=t[m],w=void 0;if(h){var L=n(N);w=c[L]||new o(r,N,m,t),p[L]=w,w.__redom_id=L}else w=C[m]||new o(r,N,m,t);w.update&&w.update(N,m,t,e);var at=b(w.el);at.__redom_view=w,d[m]=w}this.oldViews=C,this.views=d,this.oldLookup=c,this.lookup=p};function vt(i){return function(t){return t[i]}}var T=function(t,e,s,o){this.View=e,this.initData=o,this.views=[],this.pool=new st(e,s,o),this.el=ft(t),this.keySet=s!=null};T.prototype.update=function(t,e){t===void 0&&(t=[]);var s=this,o=s.keySet,n=this.views;this.pool.update(t,e);var r=this.pool,h=r.views,c=r.lookup;if(o)for(var p=0;p<n.length;p++){var d=n[p],C=d.__redom_id;c[C]==null&&(d.__redom_index=null,$(this,d))}for(var m=0;m<h.length;m++){var N=h[m];N.__redom_index=m}R(this,h),o&&(this.lookup=c),this.views=h};T.extend=function(t,e,s,o){return T.bind(T,t,e,s,o)};var U=class{constructor(t,e){this.id=t,this.handler=e,this.el=u("div.sampleSelect"),this.isSampleEntity=!0,this.handleClick=this.handleClick.bind(this),this.elements={},this.selectedID=void 0}handleClick(t){t!==this.selectedID&&this.handler.onSampleSelected(t)}onSampleStateChanged(t,e){switch(e){case v.paused:this.elements[t].classList.remove("playing");break;case v.playing:this.elements[t].classList.add("playing");break}}onSampleSelectedChanged(t){this.selectedID&&this.elements[this.selectedID].classList.remove("selected"),this.elements[t].classList.add("selected"),this.selectedID=t,window.scrollTo(0,0)}onSampleNodeValueChange(){}onSampleError(t){}onSampleCreated(t){if(this.elements[t])throw Error(`Select list already contains sample ${t}`);let e=u("span",`Sample ${new Date().toUTCString()}`),s=u("p");l(s,e);let o=u("div.sampleItem");l(o,s),o.addEventListener("click",n=>{n.preventDefault(),this.handleClick(t)}),this.elements[t]=o,l(this.el,o)}};var ot;(function(i){i[i.idle=0]="idle",i[i.start=1]="start",i[i.holding=2]="holding"})(ot||(ot={}));var S;(function(i){i[i.tap=0]="tap",i[i.hold=1]="hold"})(S||(S={}));var E=class{constructor(t,e,s=0,o){if(this.handler=t,this._stateLabels=e,this.buttonCTA=s,!(o in this._stateLabels))throw Error("Initial state not available state");let n=Object.keys(this._stateLabels).map(h=>h.length).sort().reverse()[0];this.stateLabels=Object.entries(this._stateLabels).reduce((h,[c,p])=>(h[c]=p.padEnd(n),h),{}),this.state=o,this.touchTimeout=0,this.touchState=0,this.touchHold=this.touchHold.bind(this),this.el=u("div",{className:"labelButton",style:{maxWidth:`${Math.min(n,32)}ch`}});let r=u("p");this.label=u("span",this.stateLabels[o]),l(r,this.label),l(this.el,r),this.button=u("button"),this.setButtonText(),l(this.el,this.button),this.onDown=this.onDown.bind(this),this.button.addEventListener("mousedown",this.onDown),this.touchStart=this.touchStart.bind(this),this.button.addEventListener("touchstart",this.touchStart),this.touchEnd=this.touchEnd.bind(this),this.button.addEventListener("touchend",this.touchEnd),this.onUp=this.onUp.bind(this),this.button.addEventListener("mouseup",this.onUp),this.onClick=this.onClick.bind(this),this.button.addEventListener("click",this.onClick),this.onLeave=this.onLeave.bind(this),this.button.addEventListener("mouseleave",this.onLeave)}setButtonText(t){switch(t!==void 0&&(this.buttonCTA=t),this.buttonCTA){case 0:this.button.textContent="Tap here";break;case 1:this.button.textContent="Hold here";break}}touchEnd(t){t.preventDefault(),t.stopPropagation(),clearTimeout(this.touchTimeout),this.touchState===2&&this.buttonCTA===1?this.onUp():(this.touchState=0,this.onClick())}touchHold(){this.onDown()}touchStart(t){t.preventDefault(),t.stopPropagation(),this.touchState===0&&(this.touchState=1,this.touchTimeout=window.setTimeout(this.touchHold,100))}onUp(t){t?.preventDefault(),this.touchState=0,this.el.classList.remove("down"),this.buttonCTA!==0&&this.handler.onUp?.(this.state)}onClick(t){t?.preventDefault(),this.buttonCTA===0&&this.handler.onClick?.(this.state)}onDown(t){t?.preventDefault(),this.touchState=2,this.el.classList.add("down"),this.buttonCTA!==0&&this.handler.onDown?.(this.state)}onLeave(t){t?.preventDefault(),this.touchState===2&&this.el.classList.remove("down"),this.buttonCTA===1&&this.handler.onLeave?.(this.state)}setState(t){if(!(t in this.stateLabels))throw Error("Setting unavailable button state");this.state=t,this.label.textContent=this.stateLabels[this.state]}setCTA(t){this.setButtonText(t)}enable(){this.button.disabled=!1}disable(){this.button.disabled=!0}};var x;(function(i){i.paused="Play sample",i.playing="Pause sample"})(x||(x={}));var B=class{constructor(t,e){this.sampleID=t,this.handler=e,this.el=new E(this,Object.values(x).reduce((s,o)=>Object.assign(s,{[o]:o}),{}),S.tap,x.paused),this.onClick=this.onClick.bind(this)}onClick(){this.handler.onToggleSamplePlaying(this.sampleID)}onStateChange(t){switch(t){case v.paused:this.el.setState(x.paused);break;case v.playing:this.el.setState(x.playing);break}}};var _=class{constructor(t,e,s="min"){this.id=t,this.handler=e;let o=typeof s=="number"?s:s==="max"?101:s==="mid"?51:1;this.el=u("input",{type:"range",value:o,min:1,max:101,step:1e-4}),this.debounceOnChange=this.debounceOnChange.bind(this),this.el.addEventListener("input",this.debounceOnChange),this.debounce=0,this.debounceCount=0}debounceOnChange(){this.debounceCount+=1,clearTimeout(this.debounce),this.debounceCount>=50&&(this.debounceCount=0,this.handler.onUIRangeChange(this.id,parseFloat(this.el.value))),this.debounce=window.setTimeout(()=>this.handler.onUIRangeChange(this.id,parseFloat(this.el.value)),30)}setValue(t){this.el.value=`${t}`}};var nt;(function(i){i[i.visible=0]="visible",i[i.hidden=1]="hidden"})(nt||(nt={}));var F=class{constructor(t,e,s,o){this.id=t,this.sampleID=e,this.handler=s,this.el=u("div.hidden"),this.isSampleEntity=!0,this.playBtn=new B(e,this.handler),this.volumeCtrl=new _(f.volume,this,"mid"),this.lowpassCtrl=new _(f.lowpass,this),this.distortionCtrl=new _(f.distortion,this),this.compressorCtrl=new _(f.compressor,this),this.speedCtrl=new _(f.speed,this,o.getPositionForLogRangeValue(1,.1,3)),l(this.el,this.wrap(this.playBtn)),l(this.el,this.wrap(this.compressorCtrl,"Slide to control compressor")),l(this.el,this.wrap(this.distortionCtrl,"Slide to control distortion")),l(this.el,this.wrap(this.lowpassCtrl,"Slide to control filter")),l(this.el,this.wrap(this.volumeCtrl,"Slide to control volume")),l(this.el,this.wrap(this.speedCtrl,"Slide to control speed")),this.state=1}wrap(t,e){let s=u("div");if(e){let o=u("p",e);l(s,o)}return l(s,t),s}show(){this.state!==0&&(this.state=0,this.el.classList.remove("hidden"))}hide(){this.state!==1&&(this.state=1,this.el.classList.add("hidden"))}onUIRangeChange(t,e){this.handler.onSampleControlChange(this.sampleID,t,e)}onSampleStateChanged(t,e){t===this.sampleID&&this.playBtn.onStateChange(e)}onSampleNodeValueChange(t,e,s){if(t===this.id)switch(e){case f.compressor:this.compressorCtrl.setValue(s);break;case f.distortion:this.distortionCtrl.setValue(s);break;case f.lowpass:this.lowpassCtrl.setValue(s);break;case f.speed:this.speedCtrl.setValue(s);break;case f.volume:this.volumeCtrl.setValue(s);break}}onSampleSelectedChanged(t){this.state===0&&this.sampleID!==t&&this.hide(),this.state===1&&this.sampleID===t&&this.show()}onSampleError(t){}onSampleCreated(){}};var g;(function(i){i.error="Reload context",i.noDevice="Enable input device",i.requestingDevice="Loading...",i.idle="Hold down to record",i.stopRecording="Stopping...",i.recording="Release to stop recording",i.startRecording="Starting..."})(g||(g={}));var P=class{constructor(t,e,s){this.id=t,this.handler=e,this.recordLength=s,this.el=new E(this,Object.values(g).reduce((o,n)=>Object.assign(o,{[n]:n}),{}),S.tap,g.noDevice),this.isRecordingEntity=!0,this.stopRecording=this.stopRecording.bind(this),this.onDown=this.onDown.bind(this),this.onUp=this.onUp.bind(this),this.onLeave=this.onLeave.bind(this),this.onClick=this.onClick.bind(this),this.recordingTimeout=0}stopRecording(){clearTimeout(this.recordingTimeout),this.handler.recordButtonOnStop()}onDown(t){t===g.idle&&this.handler.recordButtonOnStart()}onUp(t){t===g.recording&&this.stopRecording()}onLeave(t){t===g.recording&&this.stopRecording()}onClick(t){switch(t){case g.error:this.handler.recordButtonOnReload();break;case g.noDevice:this.handler.recordButtonOnRequest();break;default:break}}onRecordingStateChanged(t){switch(t){case a.starting:this.el.disable(),this.el.setState(g.startRecording);break;case a.recording:this.el.setState(g.recording),this.el.enable(),this.recordingTimeout=window.setTimeout(this.stopRecording,this.recordLength*1e3);break;case a.closing:this.el.disable(),this.el.setState(g.stopRecording);break;case a.idle:this.el.setState(g.idle),this.el.enable(),this.el.setCTA(S.hold);break;case a.noDevice:this.el.setState(g.noDevice),this.el.setCTA(S.tap);break;case a.error:this.el.setState(g.error);break;case a.requestingDevice:this.el.disable(),this.el.setState(g.requestingDevice);break}}onRecordingError(){this.el.setState(g.error)}};var H=class{constructor(t,e,s,o,n,r,h){this.id=t,this.handler=e,this.sampleHandler=s,this.mathUtility=o;let c=this.getElOrThrow(n),p=u("div.schallvernichtung");this.baseEl=u("div.base");let d=u("div.bg");l(c,p),R(p,[d,this.baseEl]),this.sampleBlocks=[],this.samplesMount=u("div.samplesMount"),this.sampleList=new U(this.handler.createID(),s),this.handler.addEntity(this.sampleList),this.recordBtn=new P(this.handler.createID(),r,h),this.handler.addEntity(this.recordBtn),this.isSampleEntity=!0,this.setUI()}getElOrThrow(t){let e=document.querySelector(t);if(!e)throw Error(`Couldn't find element ${t}`);return e}wrap(t,e,s){let o=u(`div${s?`.${s}`:""}`);if(e){let n=u("p",e);l(o,n)}return Array.isArray(t)?R(o,t):l(o,t),o}setUI(){l(this.baseEl,this.wrap([this.recordBtn],void 0,"topLevel")),l(this.baseEl,this.wrap([this.samplesMount,this.sampleList],void 0,"sampleManager"))}onSampleCreated(t){let e=new F(this.handler.createID(),t,this.sampleHandler,this.mathUtility);this.handler.addEntity(e),this.sampleBlocks.push(e),l(this.samplesMount,e)}onSampleStateChanged(t,e,s){}onSampleSelectedChanged(t){}onSampleNodeValueChange(){}onSampleError(t){}};var rt=class{constructor(t,e){let s=10,o=4096;this.contextNodeID="context",this.contextNode=new j(this.contextNodeID),this._entities=[],this.recordingHandler=new M(this,this.contextNode,e,o,s),this.sampleHandler=new I(this),this.mathUtility=new O,this.ui=new H(this.createID(),this,this.sampleHandler,this.mathUtility,t,this.recordingHandler,s),this.addEntity(this.ui)}addEntity(t){this._entities.push(t)}createID(){return W(10)}entities(){return this._entities}onRecorded(t){if(t.length<this.contextNode.context().sampleRate*.2)return;let e=this.createID(),s=new A(e,this.contextNode,this.mathUtility,t);this.addEntity(s),s.audioNodeManager.connectOutput(this.contextNode),this.sampleHandler.onSampleCreated(e)}};export{rt as Schallvernichtung};
