var Dn={MODE:"production",NODE_ENV:"production",SSR:!1};var E;(function(t){t[t.noDevice=0]="noDevice",t[t.requestingDevice=1]="requestingDevice",t[t.streamInitiated=2]="streamInitiated",t[t.idle=3]="idle",t[t.starting=4]="starting",t[t.ready=5]="ready",t[t.recording=6]="recording",t[t.closing=7]="closing",t[t.error=8]="error"})(E||(E={}));import.meta.env=Dn;var Tt=class{constructor(e,n,r,i,o,s){this.core=e,this.audio=n,this.workerPath=r,this.chunkSize=i,this.recordLength=o,this.handler=s,this.mediaTracks=[],this.state=E.noDevice,this.handleRecorderMessage=this.handleRecorderMessage.bind(this),this.appReady=this.appReady.bind(this),this.audio.context().audioWorklet?this.audio.context().audioWorklet.addModule(this.workerPath).catch(a=>this.emit("error",void 0,a)):(this.recorderNode=this.audio.context().createScriptProcessor(this.chunkSize,1,1),this.processChunk=this.processChunk.bind(this),this.recorderNode.addEventListener("audioprocess",this.processChunk),this.recorderNode.connect(this.audio.context().destination))}setRecorder(){if(this.audio.context().audioWorklet){if(this.recorderNode=new AudioWorkletNode(this.audio.context(),"recording-worklet",{numberOfOutputs:0,numberOfInputs:1}),!this.recorderNode)throw Error("No recording node available to connect");this.audio.getRecorderNode().audioNodeManager.connectOutput(this.recorderNode),this.recorder=this.recorderNode.port}else this.recorder=new Worker(new URL(this.workerPath,import.meta.url),{name:"recording-worker",type:"module"});this.recorder.onmessage=this.handleRecorderMessage,this.postRecorder({command:"init",data:{chunkSize:this.chunkSize,maxLength:this.recordLength,sampleRate:this.audio.context().sampleRate}})}unsetRecorder(){if(this.audio.context().audioWorklet){if(!this.recorderNode)throw Error("No recording node available to disconnect");this.audio.getRecorderNode().audioNodeManager.disconnectOutput(this.recorderNode)}this.recorder=void 0}handleRecorderMessage(e){switch(e.data.message){case"ready":this.emit("state",E.ready);break;case"recording":this.emit("state",E.recording);break;case"done":this.unsetRecorder(),this.emit("state",E.idle),e.data.buffer.length>=this.audio.context().sampleRate*.2&&this.handler.onRecorded(e.data.buffer);break}}processChunk(e){this.postRecorder({command:"chunk",buffer:e.inputBuffer.getChannelData(0)})}isRecordingEntity(e){return"isRecordingEntity"in e&&e.isRecordingEntity}postRecorder(e){this.recorder?.postMessage(e)}shiftState(e){if(e===this.state)return!1;switch(e){case E.closing:return this.state!==E.recording?!1:(this.state=E.closing,this.postRecorder({command:"stop"}),!0);case E.error:return this.state=E.error,!0;case E.streamInitiated:return this.state!==E.requestingDevice?!1:(this.state=E.streamInitiated,!0);case E.idle:return this.state!==E.closing&&this.state!==E.streamInitiated?!1:(this.state=E.idle,!0);case E.noDevice:return this.state!==E.error?!1:(this.state=E.noDevice,!0);case E.recording:return this.state!==E.ready?!1:(this.state=E.recording,!0);case E.requestingDevice:return this.state!==E.noDevice?!1:(this.state=E.requestingDevice,this.getCapture(),!0);case E.ready:return this.state!==E.starting?!1:(this.state=E.ready,this.postRecorder({command:"start"}),!0);case E.starting:return this.state!==E.idle?!1:(this.state=E.starting,this.setRecorder(),!0)}}emit(e,n,r){if(!(e==="state"&&n!==void 0&&!this.shiftState(n)))for(let i=0;i<this.core.entities().length;i++){let o=this.core.entities()[i];this.isRecordingEntity(o)&&(e==="state"&&n?o.onRecordingStateChanged(n):e==="error"&&r&&o.onRecordingError(r))}}getCapture(){navigator.mediaDevices.getUserMedia({audio:{autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1},video:!1}).then(e=>(this.mediaTracks.push(...e.getAudioTracks()),this.audio.handleStream(e))).then(()=>this.emit("state",E.streamInitiated)).catch(e=>this.emit("error",void 0,e))}recordButtonOnStart(){this.emit("state",E.starting)}recordButtonOnStop(){this.emit("state",E.closing)}recordButtonOnReload(){for(let e=0;e<this.mediaTracks.length;e++)this.mediaTracks[e].stop();this.mediaTracks.length=0,this.emit("state",E.noDevice)}recordButtonOnRequest(){this.emit("state",E.requestingDevice)}appReady(){this.emit("state",E.idle)}};var An=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let r=n[t]&63;r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r<63?e+="_":e+="-"}return e};var W;(function(t){t[t.notStarted=0]="notStarted",t[t.playing=1]="playing",t[t.paused=2]="paused"})(W||(W={}));var q;(function(t){t.distortion="distortion",t.compressor="compressor",t.volume="volume",t.lowpass="lowpass",t.speed="speed"})(q||(q={}));var Rt=class{constructor(e){this.core=e,this.state={}}isSampleEntity(e){return"isSampleEntity"in e&&e.isSampleEntity}emit(e){for(let n=0;n<this.core.entities().length;n++){let r=this.core.entities()[n];this.isSampleEntity(r)&&e(r)}}onSampleSelected(e){this.emit(n=>n.onSampleSelectedChanged(e))}onSampleControlChange(e,n,r){this.emit(i=>i.onSampleNodeValueChange(e,n,r))}onToggleSamplePlaying(e){let n=this.state[e];this.state[e]=this.state[e]===W.notStarted||this.state[e]===W.paused?W.playing:W.paused,this.emit(r=>r.onSampleStateChanged(e,this.state[e],n))}onSampleCreated(e){this.state[e.id]=W.notStarted,this.emit(n=>n.onSampleCreated(e))}};var Ke=class{constructor(e,n,r){this.id=e,this.inputNode=n,this.outputNode=r,this.inputConnections={},this.outputConnections={}}isManaged(e){return"isAudioNodeManaged"in e&&e.isAudioNodeManaged&&e.audioNodeManager!==void 0}nodeID(){return this.id}setInput(e){if(this.inputNode)throw Error(`Input node already set for ${this.id}`);this.inputNode=e}setOutput(e){if(this.outputNode)throw Error(`Output node already set for ${this.id}`);this.outputNode=e}input(){if(!this.inputNode)throw Error(`No input node set for ${this.id}`);return this.inputNode}output(){if(!this.outputNode)throw Error(`No output node set for ${this.id}`);return this.outputNode}connectInput(e){if(this.isManaged(e)){if(this.inputConnections[e.audioNodeManager.nodeID()])return;e.audioNodeManager.output().connect(this.input()),this.inputConnections[e.audioNodeManager.nodeID()]=e}else e.connect(this.input())}disconnectInput(e){if(this.isManaged(e)){if(this.inputConnections[e.audioNodeManager.nodeID()])return this.disconnectInputByID(e.audioNodeManager.nodeID());e.audioNodeManager.output().disconnect(this.input())}else e.disconnect(this.input())}disconnectInputByID(e){if(this.inputConnections[e]){let n=this.inputConnections[e];delete this.inputConnections[e],this.disconnectInput(n)}}connectOutput(e){if(this.isManaged(e)){if(this.outputConnections[e.audioNodeManager.nodeID()])return;this.output().connect(e.audioNodeManager.input()),this.outputConnections[e.audioNodeManager.nodeID()]=e}else this.output().connect(e)}disconnectOutput(e){if(this.isManaged(e)){if(this.outputConnections[e.audioNodeManager.nodeID()])return this.disconnectOutputByID(e.audioNodeManager.nodeID());this.output().disconnect(e.audioNodeManager.input())}else this.output().disconnect(e)}disconnectOutputByID(e){if(this.outputConnections[e]){let n=this.outputConnections[e];delete this.outputConnections[e],this.disconnectOutput(n)}}};var Nt=class{constructor(e){let n=window.AudioContext||window.webkitAudioContext;this._context=new n,this._context.suspend(),this.isAudioNodeManaged=!0,this.audioNodeManager=new Ke(e),this.audioNodeManager.setInput(this._context.destination)}context(){return this._context}onError(){this._context.suspend()}async reloadContext(){this._context.resume()}async handleStream(e){this._context.resume(),this.sourceNode=this._context.createMediaStreamSource(e),this.audioNodeManager.setOutput(this.sourceNode)}getRecorderNode(){return this}};var Ot=class{logRange(e,n,r,i){if(r<=n)return n;let o=1,s=1000001,a=n<0&&r<0,u=a?n*-1+1:n<=0?-1*n+1:n+1,l=a?r*-1+1:n<=0?r+u:r+1,c=Math.log(u),m=(Math.log(l)-c)/(s-o);return i?(Math.log(e/(a?-1:1)+(a||n>0?1:u))-c)/m+o:(Math.exp(c+m*(e-o))-(a||n>0?1:u))*(a?-1:1)}getPositionForLogRangeValue(e,n,r){return this.logRange(e,n,r,!0)}exponentialValueInRange(e,n,r){return this.logRange(e,n,r)}};function jr(t){for(var e=t.split(/([#.])/),n="",r="",i=[],o=0;o<e.length;o++){var s=e[o];s==="#"?r=e[++o]:s==="."?i.push(e[++o]):s.length&&(n=s)}return{tag:n||"div",id:r,className:i.join(" ")}}function Lr(t,e){var n=jr(t),r=n.tag,i=n.id,o=n.className,s=e?document.createElementNS(e,r):document.createElement(r);return i&&(s.id=i),o&&(e?s.setAttribute("class",o):s.className=o),s}function Tn(t,e){var n=J(t),r=J(e);return e===r&&r.__redom_view&&(e=r.__redom_view),r.parentNode&&(In(e,r,n),n.removeChild(r)),e}function In(t,e,n){var r=e.__redom_lifecycle;if(Rn(r)){e.__redom_lifecycle={};return}var i=n;for(e.__redom_mounted&&at(e,"onunmount");i;){var o=i.__redom_lifecycle||{};for(var s in r)o[s]&&(o[s]-=r[s]);Rn(o)&&(i.__redom_lifecycle=null),i=i.parentNode}}function Rn(t){if(t==null)return!0;for(var e in t)if(t[e])return!1;return!0}var Vr=["onmount","onremount","onunmount"],Ur=typeof window!="undefined"&&"ShadowRoot"in window;function O(t,e,n,r){var i=J(t),o=J(e);e===o&&o.__redom_view&&(e=o.__redom_view),e!==o&&(o.__redom_view=e);var s=o.__redom_mounted,a=o.parentNode;return s&&a!==i&&In(e,o,a),n!=null?r?i.replaceChild(o,J(n)):i.insertBefore(o,J(n)):i.appendChild(o),qr(e,o,i,a),e}function at(t,e){e==="onmount"||e==="onremount"?t.__redom_mounted=!0:e==="onunmount"&&(t.__redom_mounted=!1);var n=t.__redom_lifecycle;if(!!n){var r=t.__redom_view,i=0;r&&r[e]&&r[e]();for(var o in n)o&&i++;if(i)for(var s=t.firstChild;s;){var a=s.nextSibling;at(s,e),s=a}}}function qr(t,e,n,r){for(var i=e.__redom_lifecycle||(e.__redom_lifecycle={}),o=n===r,s=!1,a=0,u=Vr;a<u.length;a+=1){var l=u[a];o||t!==e&&l in t&&(i[l]=(i[l]||0)+1),i[l]&&(s=!0)}if(!s){e.__redom_lifecycle={};return}var c=n,f=!1;for((o||c&&c.__redom_mounted)&&(at(e,o?"onremount":"onmount"),f=!0);c;){var m=c.parentNode,w=c.__redom_lifecycle||(c.__redom_lifecycle={});for(var d in i)w[d]=(w[d]||0)+i[d];if(f)break;(c.nodeType===Node.DOCUMENT_NODE||Ur&&c instanceof ShadowRoot||m&&m.__redom_mounted)&&(at(c,o?"onremount":"onmount"),f=!0),c=m}}function Hr(t,e,n){var r=J(t);if(typeof e=="object")for(var i in e)Nn(r,i,e[i]);else Nn(r,e,n)}function Nn(t,e,n){n==null?t.style[e]="":t.style[e]=n}var On="http://www.w3.org/1999/xlink";function Bn(t,e,n,r){var i=J(t),o=typeof e=="object";if(o)for(var s in e)Bn(i,s,e[s],r);else{var a=i instanceof SVGElement,u=typeof n=="function";if(e==="style"&&typeof n=="object")Hr(i,n);else if(a&&u)i[e]=n;else if(e==="dataset")Pn(i,n);else if(!a&&(e in i||u)&&e!=="list")i[e]=n;else{if(a&&e==="xlink"){Mn(i,n);return}r&&e==="class"&&(n=i.className+" "+n),n==null?i.removeAttribute(e):i.setAttribute(e,n)}}}function Mn(t,e,n){if(typeof e=="object")for(var r in e)Mn(t,r,e[r]);else n!=null?t.setAttributeNS(On,e,n):t.removeAttributeNS(On,e,n)}function Pn(t,e,n){if(typeof e=="object")for(var r in e)Pn(t,r,e[r]);else n!=null?t.dataset[e]=n:delete t.dataset[e]}function Wr(t){return document.createTextNode(t??"")}function Kn(t,e,n){for(var r=0,i=e;r<i.length;r+=1){var o=i[r];if(!(o!==0&&!o)){var s=typeof o;s==="function"?o(t):s==="string"||s==="number"?t.appendChild(Wr(o)):Bt(J(o))?O(t,o):o.length?Kn(t,o,n):s==="object"&&Bn(t,o,null,n)}}}function zr(t){return typeof t=="string"?Fe(t):J(t)}function J(t){return t.nodeType&&t||!t.el&&t||J(t.el)}function Bt(t){return t&&t.nodeType}var Fn={};function Fe(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r,i=typeof t;if(i==="string")r=jn(t).cloneNode(!1);else if(Bt(t))r=t.cloneNode(!1);else if(i==="function"){var o=t;r=new(Function.prototype.bind.apply(o,[null].concat(e)))}else throw new Error("At least one argument required");return Kn(J(r),e,!0),r}var M=Fe;Fe.extend=function(e){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];var i=jn(e);return Fe.bind.apply(Fe,[this,i].concat(n))};function jn(t){return Fn[t]||(Fn[t]=Lr(t))}function je(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=J(t),i=Ln(t,e,r.firstChild);i;){var o=i.nextSibling;Tn(t,i),i=o}}function Ln(t,e,n){for(var r=n,i=new Array(e.length),o=0;o<e.length;o++)i[o]=e[o]&&J(e[o]);for(var s=0;s<e.length;s++){var a=e[s];if(!!a){var u=i[s];if(u===r){r=r.nextSibling;continue}if(Bt(u)){var l=r&&r.nextSibling,c=a.__redom_index!=null,f=c&&l===i[s+1];O(t,a,r,f),f&&(r=l);continue}a.length!=null&&(r=Ln(t,a,r))}}return r}var Vn=function(e,n,r){this.View=e,this.initData=r,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],n!=null&&(this.key=typeof n=="function"?n:Gr(n))};Vn.prototype.update=function(e,n){for(var r=this,i=r.View,o=r.key,s=r.initData,a=o!=null,u=this.lookup,l={},c=new Array(e.length),f=this.views,m=0;m<e.length;m++){var w=e[m],d=void 0;if(a){var p=o(w);d=u[p]||new i(s,w,m,e),l[p]=d,d.__redom_id=p}else d=f[m]||new i(s,w,m,e);d.update&&d.update(w,m,e,n);var b=J(d.el);b.__redom_view=d,c[m]=d}this.oldViews=f,this.views=c,this.oldLookup=u,this.lookup=l};function Gr(t){return function(e){return e[t]}}var ut=function(e,n,r,i){this.View=n,this.initData=i,this.views=[],this.pool=new Vn(n,r,i),this.el=zr(e),this.keySet=r!=null};ut.prototype.update=function(e,n){e===void 0&&(e=[]);var r=this,i=r.keySet,o=this.views;this.pool.update(e,n);var s=this.pool,a=s.views,u=s.lookup;if(i)for(var l=0;l<o.length;l++){var c=o[l],f=c.__redom_id;u[f]==null&&(c.__redom_index=null,Tn(this,c))}for(var m=0;m<a.length;m++){var w=a[m];w.__redom_index=m}je(this,a),i&&(this.lookup=u),this.views=a};ut.extend=function(e,n,r,i){return ut.bind(ut,e,n,r,i)};var Mt=class{constructor(e,n){this.id=e,this.handler=n,this.el=M("div.sampleSelect"),this.isSampleEntity=!0,this.handleClick=this.handleClick.bind(this),this.elements={},this.selectedID=void 0}handleClick(e){e!==this.selectedID&&this.handler.onSampleSelected(e)}onSampleStateChanged(e,n){switch(n){case W.paused:this.elements[e].classList.remove("playing");break;case W.playing:this.elements[e].classList.add("playing");break}}onSampleSelectedChanged(e){this.selectedID&&this.elements[this.selectedID].classList.remove("selected"),this.elements[e].classList.add("selected"),this.selectedID=e}onSampleError(e){}onSampleCreated(e){if(this.elements[e.id])throw Error(`Select list already contains sample ${e.id}`);let n=M("div.sampleItem"),r=M("span",e.label),i=M("p");O(i,r),O(n,i),n.addEventListener("click",o=>{o.preventDefault(),this.handleClick(e.id)}),this.elements[e.id]=n,O(this.el,n)}onSampleNodeValueChange(){}};var Un;(function(t){t[t.idle=0]="idle",t[t.start=1]="start",t[t.holding=2]="holding"})(Un||(Un={}));var ve;(function(t){t[t.tap=0]="tap",t[t.hold=1]="hold"})(ve||(ve={}));var Le=class{constructor(e,n,r=0,i){if(this.handler=e,this._stateLabels=n,this.buttonCTA=r,!(i in this._stateLabels))throw Error("Initial state not available state");let o=Object.keys(this._stateLabels).map(a=>a.length).sort().reverse()[0];this.stateLabels=Object.entries(this._stateLabels).reduce((a,[u,l])=>(a[u]=l.padEnd(o),a),{}),this.state=i,this.touchTimeout=0,this.touchState=0,this.touchHold=this.touchHold.bind(this),this.el=M("div",{className:"labelButton",style:{maxWidth:`${Math.min(o,32)}ch`}});let s=M("p");this.label=M("span",this.stateLabels[i]),O(s,this.label),O(this.el,s),this.button=M("button"),this.setButtonText(),O(this.el,this.button),this.onDown=this.onDown.bind(this),this.button.addEventListener("mousedown",this.onDown),this.touchStart=this.touchStart.bind(this),this.button.addEventListener("touchstart",this.touchStart),this.touchEnd=this.touchEnd.bind(this),this.button.addEventListener("touchend",this.touchEnd),this.onUp=this.onUp.bind(this),this.button.addEventListener("mouseup",this.onUp),this.onClick=this.onClick.bind(this),this.button.addEventListener("click",this.onClick),this.onLeave=this.onLeave.bind(this),this.button.addEventListener("mouseleave",this.onLeave)}setButtonText(e){switch(e!==void 0&&(this.buttonCTA=e),this.buttonCTA){case 0:this.button.textContent="Tap here";break;case 1:this.button.textContent="Hold here";break}}touchEnd(e){e.preventDefault(),e.stopPropagation(),clearTimeout(this.touchTimeout),this.touchState===2&&this.buttonCTA===1?this.onUp():(this.touchState=0,this.onClick())}touchHold(){this.onDown()}touchStart(e){e.preventDefault(),e.stopPropagation(),this.touchState===0&&(this.touchState=1,this.touchTimeout=window.setTimeout(this.touchHold,100))}onUp(e){e?.preventDefault(),this.touchState=0,this.el.classList.remove("down"),this.buttonCTA!==0&&this.handler.onUp?.(this.state)}onClick(e){e?.preventDefault(),this.buttonCTA===0&&this.handler.onClick?.(this.state)}onDown(e){e?.preventDefault(),this.touchState=2,this.el.classList.add("down"),this.buttonCTA!==0&&this.handler.onDown?.(this.state)}onLeave(e){e?.preventDefault(),this.touchState===2&&this.el.classList.remove("down"),this.buttonCTA===1&&this.handler.onLeave?.(this.state)}setState(e){if(!(e in this.stateLabels))throw Error("Setting unavailable button state");this.state=e,this.label.textContent=this.stateLabels[this.state]}setCTA(e){this.setButtonText(e)}enable(){this.button.disabled=!1}disable(){this.button.disabled=!0}};var Ae;(function(t){t.paused="Play sample",t.playing="Pause sample"})(Ae||(Ae={}));var Pt=class{constructor(e,n){this.sampleID=e,this.handler=n,this.el=new Le(this,Object.values(Ae).reduce((r,i)=>Object.assign(r,{[i]:i}),{}),ve.tap,Ae.paused),this.onClick=this.onClick.bind(this)}onClick(){this.handler.onToggleSamplePlaying(this.sampleID)}onStateChange(e){switch(e){case W.paused:this.el.setState(Ae.paused);break;case W.playing:this.el.setState(Ae.playing);break}}};var qn;(function(t){t[t.locked=0]="locked",t[t.idle=1]="idle",t[t.down=2]="down",t[t.released=3]="released"})(qn||(qn={}));var Hn;(function(t){t[t.down=-1]="down",t[t.up=1]="up"})(Hn||(Hn={}));var we=class{constructor(e,n,r,i,o=1){this.id=e,this.type=n,this.handler=r,this.value=o,this.el=M("div.rangeChange");let s=M("p");this.labelEl=M("span",i),O(s,this.labelEl),O(this.el,s),this.numberEl=M("div",{className:"rangeValue"},`${o}`),O(this.el,this.numberEl);let a=M("div.rangeBtns");this.decBtn=M("button","Less"),this.incBtn=M("button","More"),je(a,[this.decBtn,this.incBtn]),O(this.el,a),this.interval=0,this.increment=1e4,this.maxValue=1000001,this.minValue=1,this.state=1,this.onDown=this.onDown.bind(this),this.onUp=this.onUp.bind(this),this.handleUp=this.handleUp.bind(this),this.setValue=this.setValue.bind(this),this.setButtonEvents(this.decBtn,-1),this.setButtonEvents(this.incBtn,1)}handleUp(){window.removeEventListener("mouseup",this.handleUp),window.removeEventListener("touchend",this.handleUp),this.onUp()}setButtonEvents(e,n){e.addEventListener("mousedown",r=>{r.preventDefault(),window.addEventListener("mouseup",this.handleUp),window.addEventListener("touchend",this.handleUp),this.onDown(n)}),e.addEventListener("touchstart",r=>{r.preventDefault(),window.addEventListener("mouseup",this.handleUp),window.addEventListener("touchend",this.handleUp),this.onDown(n)})}onDown(e){this.state===1&&(this.state=2,this.interval=window.setInterval(()=>{this.handler.onUIRangeChange(this.type,Math.max(Math.min(this.value+(Math.random()*(e*(this.increment-1e3))+1e3),this.maxValue),this.minValue))},30))}onUp(){this.state=1,clearInterval(this.interval)}setValue(e){this.value=e,this.numberEl.textContent=`${e}`}};var Wn;(function(t){t[t.visible=0]="visible",t[t.hidden=1]="hidden"})(Wn||(Wn={}));var Kt=class{constructor(e,n,r,i){this.id=e,this.handler=n,this.el=M("div.hidden"),this.isSampleEntity=!0,this.sampleID=i.id;let o=M("p.sampleLabel");this.labelEl=M("span",i.label),O(o,this.labelEl),O(this.el,o),this.playBtn=new Pt(this.sampleID,this.handler),this.playBtn.el.el.classList.add("playBtn"),this.volumeCtrl=new we(r.createID(),q.volume,this,"Volume",i.volume),r.addEntity(this.volumeCtrl),this.lowpassCtrl=new we(r.createID(),q.lowpass,this,"Filter",i.lowpass),r.addEntity(this.lowpassCtrl),this.distortionCtrl=new we(r.createID(),q.distortion,this,"Distortion",i.distortion),r.addEntity(this.distortionCtrl),this.compressorCtrl=new we(r.createID(),q.compressor,this,"Compressor",i.compressor),r.addEntity(this.compressorCtrl),this.speedCtrl=new we(r.createID(),q.speed,this,"Speed",i.speed),r.addEntity(this.speedCtrl),O(this.el,this.playBtn),O(this.el,this.compressorCtrl),O(this.el,this.distortionCtrl),O(this.el,this.lowpassCtrl),O(this.el,this.volumeCtrl),O(this.el,this.speedCtrl),this.state=1}show(){this.state!==0&&(this.state=0,this.el.classList.remove("hidden"))}hide(){this.state!==1&&(this.state=1,this.el.classList.add("hidden"))}onUIRangeChange(e,n){this.handler.onSampleControlChange(this.sampleID,e,n)}onSampleStateChanged(e,n){e===this.sampleID&&this.playBtn.onStateChange(n)}onSampleNodeValueChange(e,n,r){if(e===this.sampleID)switch(n){case q.compressor:this.compressorCtrl.setValue(r);break;case q.distortion:this.distortionCtrl.setValue(r);break;case q.lowpass:this.lowpassCtrl.setValue(r);break;case q.speed:this.speedCtrl.setValue(r);break;case q.volume:this.volumeCtrl.setValue(r);break}}onSampleSelectedChanged(e){this.state===0&&this.sampleID!==e&&this.hide(),this.state===1&&this.sampleID===e&&this.show()}onSampleError(e){}onSampleCreated(){}};var Y;(function(t){t.error="Reload context",t.noDevice="Enable input device",t.requestingDevice="Loading...",t.idle="Hold down to record",t.stopRecording="Stopping...",t.recording="Release to stop recording",t.startRecording="Starting..."})(Y||(Y={}));var Ft=class{constructor(e,n,r){this.id=e,this.handler=n,this.recordLength=r,this.el=new Le(this,Object.values(Y).reduce((i,o)=>Object.assign(i,{[o]:o}),{}),ve.tap,Y.noDevice),this.isRecordingEntity=!0,this.stopRecording=this.stopRecording.bind(this),this.onDown=this.onDown.bind(this),this.onUp=this.onUp.bind(this),this.onLeave=this.onLeave.bind(this),this.onClick=this.onClick.bind(this),this.recordingTimeout=0}stopRecording(){clearTimeout(this.recordingTimeout),this.handler.recordButtonOnStop()}onDown(e){e===Y.idle&&this.handler.recordButtonOnStart()}onUp(e){e===Y.recording&&this.stopRecording()}onLeave(e){e===Y.recording&&this.stopRecording()}onClick(e){switch(e){case Y.error:this.handler.recordButtonOnReload();break;case Y.noDevice:this.handler.recordButtonOnRequest();break;default:break}}onRecordingStateChanged(e){switch(e){case E.starting:this.el.disable(),this.el.setState(Y.startRecording);break;case E.recording:this.el.setState(Y.recording),this.el.enable(),this.recordingTimeout=window.setTimeout(this.stopRecording,this.recordLength*1e3);break;case E.closing:this.el.disable(),this.el.setState(Y.stopRecording);break;case E.idle:this.el.setState(Y.idle),this.el.enable(),this.el.setCTA(ve.hold);break;case E.noDevice:this.el.setState(Y.noDevice),this.el.setCTA(ve.tap);break;case E.error:this.el.setState(Y.error);break;case E.requestingDevice:this.el.disable(),this.el.setState(Y.requestingDevice);break}}onRecordingError(){this.el.setState(Y.error)}};var jt=class{constructor(e,n,r,i,o,s,a){this.id=e,this.handler=n,this.sampleHandler=r;let u=this.getElOrThrow(i);this.addStylesheet(a);let l=M("div.schallvernichtung");this.baseEl=M("div.base"),O(u,l),O(l,this.baseEl),this.sampleBlocks=[],this.samplesMount=M("div.samplesMount"),this.sampleList=new Mt(this.handler.createID(),r),this.handler.addEntity(this.sampleList),this.recordBtn=new Ft(this.handler.createID(),o,s),this.handler.addEntity(this.recordBtn),this.isSampleEntity=!0,this.setUI()}addStylesheet(e){let n=this.getElOrThrow("head"),r=M("link",{type:"text/css",rel:"stylesheet",href:e});n.appendChild(r)}getElOrThrow(e){let n=document.querySelector(e);if(!n)throw Error(`Couldn't find element ${e}`);return n}wrap(e,n,r){let i=M(`div${r?`.${r}`:""}`);if(n){let o=M("p",n);O(i,o)}return Array.isArray(e)?je(i,e):O(i,e),i}setUI(){O(this.baseEl,this.wrap([this.recordBtn],void 0,"topLevel")),O(this.baseEl,this.wrap([this.samplesMount,this.sampleList],void 0,"sampleManager"))}onSampleCreated(e){let n=new Kt(this.handler.createID(),this.sampleHandler,this.handler,e);this.handler.addEntity(n),this.sampleBlocks.push(n),O(this.samplesMount,n)}onSampleSelectedChanged(){this.baseEl.scrollTo(0,0)}onSampleError(e){}onSampleNodeValueChange(){}onSampleStateChanged(){}};var P=function(){return P=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},P.apply(this,arguments)};function Lt(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var Q=Object.keys,Z=Array.isArray,j=typeof self!="undefined"?self:typeof window!="undefined"?window:global;typeof Promise!="undefined"&&!j.Promise&&(j.Promise=Promise);function re(t,e){return typeof e!="object"||Q(e).forEach(function(n){t[n]=e[n]}),t}var zn=Object.getPrototypeOf,Yr={}.hasOwnProperty;function ie(t,e){return Yr.call(t,e)}function Ve(t,e){typeof e=="function"&&(e=e(zn(t))),Q(e).forEach(function(n){he(t,n,e[n])})}var Gn=Object.defineProperty;function he(t,e,n,r){Gn(t,e,re(n&&ie(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Ie(t){return{from:function(e){return t.prototype=Object.create(e.prototype),he(t.prototype,"constructor",t),{extend:Ve.bind(null,t.prototype)}}}}var Qr=Object.getOwnPropertyDescriptor;function Vt(t,e){var n=Qr(t,e),r;return n||(r=zn(t))&&Vt(r,e)}var Xr=[].slice;function lt(t,e,n){return Xr.call(t,e,n)}function Yn(t,e){return e(t)}function Ue(t){if(!t)throw new Error("Assertion Failed")}function Qn(t){j.setImmediate?setImmediate(t):setTimeout(t,0)}function Xn(t,e){return t.reduce(function(n,r,i){var o=e(r,i);return o&&(n[o[0]]=o[1]),n},{})}function $r(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function se(t,e){if(ie(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var o=se(t,e[r]);n.push(o)}return n}var s=e.indexOf(".");if(s!==-1){var a=t[e.substr(0,s)];return a===void 0?void 0:se(a,e.substr(s+1))}}function oe(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Ue(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)oe(t,e[r],n[r])}else{var o=e.indexOf(".");if(o!==-1){var s=e.substr(0,o),a=e.substr(o+1);if(a==="")n===void 0?Z(t)&&!isNaN(parseInt(s))?t.splice(s,1):delete t[s]:t[s]=n;else{var u=t[s];u||(u=t[s]={}),oe(u,a,n)}}else n===void 0?Z(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function $n(t,e){typeof e=="string"?oe(t,e,void 0):"length"in e&&[].map.call(e,function(n){oe(t,n,void 0)})}function Jn(t){var e={};for(var n in t)ie(t,n)&&(e[n]=t[n]);return e}var Jr=[].concat;function Zn(t){return Jr.apply([],t)}var er="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(Zn([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return j[t]}),Zr=er.map(function(t){return j[t]}),ei=Xn(er,function(t){return[t,!0]});function qe(t){if(!t||typeof t!="object")return t;var e;if(Z(t)){e=[];for(var n=0,r=t.length;n<r;++n)e.push(qe(t[n]))}else if(Zr.indexOf(t.constructor)>=0)e=t;else{e=t.constructor?Object.create(t.constructor.prototype):{};for(var i in t)ie(t,i)&&(e[i]=qe(t[i]))}return e}var ti={}.toString;function Ut(t){return ti.call(t).slice(8,-1)}var qt=function(t,e){return e==="Array"?""+t.map(function(n){return qt(n,Ut(n))}):e==="ArrayBuffer"?""+new Uint8Array(t):e==="Date"?t.getTime():ArrayBuffer.isView(t)?""+new Uint8Array(t.buffer):t};function Ht(t,e,n,r){return n=n||{},r=r||"",Q(t).forEach(function(i){if(!ie(e,i))n[r+i]=void 0;else{var o=t[i],s=e[i];if(typeof o=="object"&&typeof s=="object"&&o&&s){var a=Ut(o),u=Ut(s);a===u?ei[a]?qt(o,a)!==qt(s,u)&&(n[r+i]=e[i]):Ht(o,s,n,r+i+"."):n[r+i]=e[i]}else o!==s&&(n[r+i]=e[i])}}),Q(e).forEach(function(i){ie(t,i)||(n[r+i]=e[i])}),n}var tr=typeof Symbol!="undefined"&&Symbol.iterator,ni=tr?function(t){var e;return t!=null&&(e=t[tr])&&e.apply(t)}:function(){return null},Te={};function fe(t){var e,n,r,i;if(arguments.length===1){if(Z(t))return t.slice();if(this===Te&&typeof t=="string")return[t];if(i=ni(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var nr=typeof Symbol!="undefined"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ae=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ir(t,e){ae=t,rr=e}var rr=function(){return!0},ri=!new Error("").stack;function Re(){if(ri)try{throw new Error}catch(t){return t}return new Error}function Wt(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(rr).map(function(r){return`
`+r}).join("")):""}var ii=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],or=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],zt=ii.concat(or),oi={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function Ne(t,e){this._e=Re(),this.name=t,this.message=e}Ie(Ne).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Wt(this._e,2))}},toString:function(){return this.name+": "+this.message}});function sr(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function ct(t,e,n,r){this._e=Re(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=sr(t,e)}Ie(ct).from(Ne);function He(t,e){this._e=Re(),this.name="BulkError",this.failures=e,this.message=sr(t,e)}Ie(He).from(Ne);var si=zt.reduce(function(t,e){return t[e]=e+"Error",t},{}),ai=Ne,I=zt.reduce(function(t,e){var n=e+"Error";function r(i,o){this._e=Re(),this.name=n,i?typeof i=="string"?(this.message=""+i+(o?`
 `+o:""),this.inner=o||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=oi[e]||n,this.inner=null)}return Ie(r).from(ai),t[e]=r,t},{});I.Syntax=SyntaxError;I.Type=TypeError;I.Range=RangeError;var ar=or.reduce(function(t,e){return t[e+"Error"]=I[e],t},{});function ui(t,e){if(!t||t instanceof Ne||t instanceof TypeError||t instanceof SyntaxError||!t.name||!ar[t.name])return t;var n=new ar[t.name](e||t.message,t);return"stack"in t&&he(n,"stack",{get:function(){return this.inner.stack}}),n}var ht=zt.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=I[e]),t},{});ht.ModifyError=ct;ht.DexieError=Ne;ht.BulkError=He;function K(){}function We(t){return t}function li(t,e){return t==null||t===We?e:function(n){return e(t(n))}}function be(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ci(t,e){return t===K?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?be(r,this.onsuccess):r),i&&(this.onerror=this.onerror?be(i,this.onerror):i),o!==void 0?o:n}}function hi(t,e){return t===K?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?be(n,this.onsuccess):n),r&&(this.onerror=this.onerror?be(r,this.onerror):r)}}function fi(t,e){return t===K?e:function(n){var r=t.apply(this,arguments);re(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?be(i,this.onsuccess):i),o&&(this.onerror=this.onerror?be(o,this.onerror):o),r===void 0?s===void 0?void 0:s:re(r,s)}}function di(t,e){return t===K?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function ur(t,e){return t===K?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}var ze={},pi=100,vi=20,lr=100,Gt=typeof Promise=="undefined"?[]:function(){var t=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[t,t.__proto__,t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,e.__proto__,t]}(),Yt=Gt[0],ft=Gt[1],Qt=Gt[2],cr=ft&&ft.then,dt=Yt&&Yt.constructor,Xt=!!Qt,$t=!1,mi=Qt?function(){Qt.then(pt)}:j.setImmediate?setImmediate.bind(null,pt):j.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){pt(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(pt,0)},Ye=function(t,e){Ge.push([t,e]),vt&&(mi(),vt=!1)},Jt=!0,vt=!0,_e=[],mt=[],Zt=null,en=We,Oe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:hr,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{hr(t[0],t[1])}catch(e){}})}},k=Oe,Ge=[],xe=0,yt=[];function _(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=K,this._lib=!1;var e=this._PSD=k;if(ae&&(this._stackHolder=Re(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==ze)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&tn(this,this._value);return}this._state=null,this._value=null,++e.ref,fr(this,t)}var nn={get:function(){var t=k,e=gt;function n(r,i){var o=this,s=!t.global&&(t!==k||e!==gt),a=s&&!Ce(),u=new _(function(l,c){rn(o,new dr(wt(r,t,s,a),wt(i,t,s,a),l,c,t))});return ae&&pr(u,this),u}return n.prototype=ze,n},set:function(t){he(this,"then",t&&t.prototype===ze?nn:{get:function(){return t},set:nn.set})}};Ve(_.prototype,{then:nn,_then:function(t,e){rn(this,new dr(null,null,t,e,k))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,function(r){return r instanceof e?n(r):bt(r)}):this.then(null,function(r){return r&&r.name===e?n(r):bt(r)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),bt(e)})},stack:{get:function(){if(this._stack)return this._stack;try{$t=!0;var t=vr(this,[],vi),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{$t=!1}}},timeout:function(t,e){var n=this;return t<Infinity?new _(function(r,i){var o=setTimeout(function(){return i(new I.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&he(_.prototype,Symbol.toStringTag,"Dexie.Promise");Oe.env=mr();function dr(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}Ve(_,{all:function(){var t=fe.apply(null,arguments).map(_t);return new _(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(i,o){return _.resolve(i).then(function(s){t[o]=s,--r||e(t)},n)})})},resolve:function(t){if(t instanceof _)return t;if(t&&typeof t.then=="function")return new _(function(n,r){t.then(n,r)});var e=new _(ze,!0,t);return pr(e,Zt),e},reject:bt,race:function(){var t=fe.apply(null,arguments).map(_t);return new _(function(e,n){t.map(function(r){return _.resolve(r).then(e,n)})})},PSD:{get:function(){return k},set:function(t){return k=t}},totalEchoes:{get:function(){return gt}},newPSD:Se,usePSD:Qe,scheduler:{get:function(){return Ye},set:function(t){Ye=t}},rejectionMapper:{get:function(){return en},set:function(t){en=t}},follow:function(t,e){return new _(function(n,r){return Se(function(i,o){var s=k;s.unhandleds=[],s.onunhandled=o,s.finalize=be(function(){var a=this;yi(function(){a.unhandleds.length===0?i():o(a.unhandleds[0])})},s.finalize),t()},e,n,r)})}});dt&&(dt.allSettled&&he(_,"allSettled",function(){var t=fe.apply(null,arguments).map(_t);return new _(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(i,o){return _.resolve(i).then(function(s){return r[o]={status:"fulfilled",value:s}},function(s){return r[o]={status:"rejected",reason:s}}).then(function(){return--n||e(r)})})})}),dt.any&&typeof AggregateError!="undefined"&&he(_,"any",function(){var t=fe.apply(null,arguments).map(_t);return new _(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach(function(o,s){return _.resolve(o).then(function(a){return e(a)},function(a){i[s]=a,--r||n(new AggregateError(i))})})})}));function fr(t,e){try{e(function(n){if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Xe();n&&typeof n.then=="function"?fr(t,function(i,o){n instanceof _?n._then(i,o):n.then(i,o)}):(t._state=!0,t._value=n,yr(t)),r&&$e()}},tn.bind(null,t))}catch(n){tn(t,n)}}function tn(t,e){if(mt.push(e),t._state===null){var n=t._lib&&Xe();e=en(e),t._state=!1,t._value=e,ae&&e!==null&&typeof e=="object"&&!e._promise&&$r(function(){var r=Vt(e,"stack");e._promise=t,he(e,"stack",{get:function(){return $t?r&&(r.get?r.get.apply(e):r.value):t.stack}})}),gi(t),yr(t),n&&$e()}}function yr(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)rn(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),xe===0&&(++xe,Ye(function(){--xe==0&&on()},[]))}function rn(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++xe,Ye(wi,[n,t,e])}function wi(t,e,n){try{Zt=e;var r,i=e._value;e._state?r=t(i):(mt.length&&(mt=[]),r=t(i),mt.indexOf(i)===-1&&bi(e)),n.resolve(r)}catch(o){n.reject(o)}finally{Zt=null,--xe==0&&on(),--n.psd.ref||n.psd.finalize()}}function vr(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,o,s;i!=null?(o=i.name||"Error",s=i.message||i,r=Wt(i,0)):(o=i,s=""),e.push(o+(s?": "+s:"")+r)}return ae&&(r=Wt(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&vr(t._prev,e,n)),e}function pr(t,e){var n=e?e._numPrev+1:0;n<pi&&(t._prev=e,t._numPrev=n)}function pt(){Xe()&&$e()}function Xe(){var t=Jt;return Jt=!1,vt=!1,t}function $e(){var t,e,n;do for(;Ge.length>0;)for(t=Ge,Ge=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(Ge.length>0);Jt=!0,vt=!0}function on(){var t=_e;_e=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var e=yt.slice(0),n=e.length;n;)e[--n]()}function yi(t){function e(){t(),yt.splice(yt.indexOf(e),1)}yt.push(e),++xe,Ye(function(){--xe==0&&on()},[])}function gi(t){_e.some(function(e){return e._value===t._value})||_e.push(t)}function bi(t){for(var e=_e.length;e;)if(_e[--e]._value===t._value){_e.splice(e,1);return}}function bt(t){return new _(ze,!1,t)}function L(t,e){var n=k;return function(){var r=Xe(),i=k;try{return me(n,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{me(i,!1),r&&$e()}}}var X={awaits:0,echoes:0,id:0},_i=0,xt=[],sn=0,gt=0,xi=0;function Se(t,e,n,r){var i=k,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++xi;var s=Oe.env;o.env=Xt?{Promise:_,PromiseProp:{value:_,configurable:!0,writable:!0},all:_.all,race:_.race,allSettled:_.allSettled,any:_.any,resolve:_.resolve,reject:_.reject,nthen:gr(s.nthen,o),gthen:gr(s.gthen,o)}:{},e&&re(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Qe(o,t,n,r);return o.ref===0&&o.finalize(),a}function Je(){return X.id||(X.id=++_i),++X.awaits,X.echoes+=lr,X.id}function Ce(){return X.awaits?(--X.awaits==0&&(X.id=0),X.echoes=X.awaits*lr,!0):!1}(""+cr).indexOf("[native code]")===-1&&(Je=Ce=K);function _t(t){return X.echoes&&t&&t.constructor===dt?(Je(),t.then(function(e){return Ce(),e},function(e){return Ce(),$(e)})):t}function Ci(t){++gt,(!X.echoes||--X.echoes==0)&&(X.echoes=X.id=0),xt.push(k),me(t,!0)}function Si(){var t=xt[xt.length-1];xt.pop(),me(t,!1)}function me(t,e){var n=k;if((e?X.echoes&&(!sn++||t!==k):sn&&(!--sn||t!==k))&&wr(e?Ci.bind(null,t):Si),t!==k&&(k=t,n===Oe&&(Oe.env=mr()),Xt)){var r=Oe.env.Promise,i=t.env;ft.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(j,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function mr(){var t=j.Promise;return Xt?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(j,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:ft.then,gthen:t.prototype.then}:{}}function Qe(t,e,n,r,i){var o=k;try{return me(t,!0),e(n,r,i)}finally{me(o,!1)}}function wr(t){cr.call(Yt,t)}function wt(t,e,n,r){return typeof t!="function"?t:function(){var i=k;n&&Je(),me(e,!0);try{return t.apply(this,arguments)}finally{me(i,!1),r&&wr(Ce)}}}function gr(t,e){return function(n,r){return t.call(this,wt(n,e),wt(r,e))}}var br="unhandledrejection";function hr(t,e){var n;try{n=e.onuncatched(t)}catch(o){}if(n!==!1)try{var r,i={promise:e,reason:t};if(j.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(br,!0,!0),re(r,i)):j.CustomEvent&&(r=new CustomEvent(br,{detail:i}),re(r,i)),r&&j.dispatchEvent&&(dispatchEvent(r),!j.PromiseRejectionEvent&&j.onunhandledrejection))try{j.onunhandledrejection(r)}catch(o){}ae&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch(o){}}var $=_.reject;function _r(t,e,n,r){if(!t._state.openComplete&&!k.letThrough){if(!t._state.isBeingOpened){if(!t._options.autoOpen)return $(new I.DatabaseClosed);t.open().catch(K)}return t._state.dbReadyPromise.then(function(){return _r(t,e,n,r)})}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create()}catch(o){return $(o)}return i._promise(e,function(o,s){return Se(function(){return k.trans=i,r(o,s,i)})}).then(function(o){return i._completion.then(function(){return o})})}}var xr="3.0.3",Be=String.fromCharCode(65535),an=-Infinity,de="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Cr="String expected.",Ze=[],un=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ei=un,ki=un,Sr=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)},Ct="__dbnames",ln="readonly",cn="readwrite";function Ee(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Er={type:3,lower:-Infinity,lowerOpen:!1,upper:[[]],upperOpen:!1};function St(t){return function(e){return se(e,t)===void 0&&(e=qe(e),$n(e,t)),e}}var Di=function(){function t(){}return t.prototype._trans=function(e,n,r){var i=this._tx||k.trans,o=this.name;function s(u,l,c){if(!c.schema[o])throw new I.NotFound("Table "+o+" not part of transaction");return n(c.idbtrans,c)}var a=Xe();try{return i&&i.db===this.db?i===k.trans?i._promise(e,s,r):Se(function(){return i._promise(e,s,r)},{trans:i,transless:k.transless||k}):_r(this.db,e,[this.name],s)}finally{a&&$e()}},t.prototype.get=function(e,n){var r=this;return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(o){return r.hook.reading.fire(o)})}).then(n)},t.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Z(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var n=Q(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(c){return c.compound&&n.every(function(f){return c.keyPath.indexOf(f)>=0})&&c.keyPath.every(function(f){return n.indexOf(f)>=0})})[0];if(r&&this.db._maxKey!==Be)return this.where(r.name).equals(r.keyPath.map(function(c){return e[c]}));!r&&ae&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a "+("compound index ["+n.join("+")+"]"));var i=this.schema.idxByName,o=this.db._deps.indexedDB;function s(c,f){try{return o.cmp(c,f)===0}catch(m){return!1}}var a=n.reduce(function(c,f){var m=c[0],w=c[1],d=i[f],p=e[f];return[m||d,m||!d?Ee(w,d&&d.multi?function(b){var x=se(b,f);return Z(x)&&x.some(function(g){return s(p,g)})}:function(b){return s(p,se(b,f))}):w]},[null,null]),u=a[0],l=a[1];return u?this.where(u.name).equals(e[u.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")},t.prototype.filter=function(e){return this.toCollection().and(e)},t.prototype.count=function(e){return this.toCollection().count(e)},t.prototype.offset=function(e){return this.toCollection().offset(e)},t.prototype.limit=function(e){return this.toCollection().limit(e)},t.prototype.each=function(e){return this.toCollection().each(e)},t.prototype.toArray=function(e){return this.toCollection().toArray(e)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,Z(e)?"["+e.join("+")+"]":e))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(e){this.schema.mappedClass=e;var n=function(r){if(!r)return r;var i=Object.create(e.prototype);for(var o in r)if(ie(r,o))try{i[o]=r[o]}catch(s){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e},t.prototype.defineClass=function(){function e(n){re(this,n)}return this.mapToClass(e)},t.prototype.add=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,s=i.keyPath,a=e;return s&&o&&(a=St(s)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"add",keys:n!=null?[n]:null,values:[a]})}).then(function(u){return u.numFailures?_.reject(u.failures[0]):u.lastResult}).then(function(u){if(s)try{oe(e,s,u)}catch(l){}return u})},t.prototype.update=function(e,n){if(typeof n!="object"||Z(n))throw new I.InvalidArgument("Modifications must be an object.");if(typeof e=="object"&&!Z(e)){Q(n).forEach(function(i){oe(e,i,n[i])});var r=se(e,this.schema.primKey.keyPath);return r===void 0?$(new I.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(e).modify(n)},t.prototype.put=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,s=i.keyPath,a=e;return s&&o&&(a=St(s)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"put",values:[a],keys:n!=null?[n]:null})}).then(function(u){return u.numFailures?_.reject(u.failures[0]):u.lastResult}).then(function(u){if(s)try{oe(e,s,u)}catch(l){}return u})},t.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?_.reject(r.failures[0]):void 0})},t.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:Er})}).then(function(n){return n.numFailures?_.reject(n.failures[0]):void 0})},t.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(o){return n.hook.reading.fire(o)})})})},t.prototype.bulkAdd=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0;r=r||(o?void 0:n);var s=r?r.allKeys:void 0;return this._trans("readwrite",function(a){var u=i.schema.primKey,l=u.auto,c=u.keyPath;if(c&&o)throw new I.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new I.InvalidArgument("Arguments objects and keys must have the same length");var f=e.length,m=c&&l?e.map(St(c)):e;return i.core.mutate({trans:a,type:"add",keys:o,values:m,wantResults:s}).then(function(w){var d=w.numFailures,p=w.results,b=w.lastResult,x=w.failures,g=s?p:b;if(d===0)return g;throw new He(i.name+".bulkAdd(): "+d+" of "+f+" operations failed",Object.keys(x).map(function(y){return x[y]}))})})},t.prototype.bulkPut=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0;r=r||(o?void 0:n);var s=r?r.allKeys:void 0;return this._trans("readwrite",function(a){var u=i.schema.primKey,l=u.auto,c=u.keyPath;if(c&&o)throw new I.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new I.InvalidArgument("Arguments objects and keys must have the same length");var f=e.length,m=c&&l?e.map(St(c)):e;return i.core.mutate({trans:a,type:"put",keys:o,values:m,wantResults:s}).then(function(w){var d=w.numFailures,p=w.results,b=w.lastResult,x=w.failures,g=s?p:b;if(d===0)return g;throw new He(i.name+".bulkPut(): "+d+" of "+f+" operations failed",Object.keys(x).map(function(y){return x[y]}))})})},t.prototype.bulkDelete=function(e){var n=this,r=e.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:e})}).then(function(i){var o=i.numFailures,s=i.lastResult,a=i.failures;if(o===0)return s;throw new He(n.name+".bulkDelete(): "+o+" of "+r+" operations failed",a)})},t}();function Et(t){var e={},n=function(a,u){if(u){for(var l=arguments.length,c=new Array(l-1);--l;)c[l-1]=arguments[l];return e[a].subscribe.apply(null,c),t}else if(typeof a=="string")return e[a]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(a,u,l){if(typeof a=="object")return s(a);u||(u=di),l||(l=K);var c={subscribers:[],fire:l,subscribe:function(f){c.subscribers.indexOf(f)===-1&&(c.subscribers.push(f),c.fire=u(c.fire,f))},unsubscribe:function(f){c.subscribers=c.subscribers.filter(function(m){return m!==f}),c.fire=c.subscribers.reduce(u,l)}};return e[a]=n[a]=c,c}function s(a){Q(a).forEach(function(u){var l=a[u];if(Z(l))o(u,a[u][0],a[u][1]);else if(l==="asap")var c=o(u,We,function(){for(var m=arguments.length,w=new Array(m);m--;)w[m]=arguments[m];c.subscribers.forEach(function(d){Qn(function(){d.apply(null,w)})})});else throw new I.InvalidArgument("Invalid event config")})}}function et(t,e){return Ie(e).from({prototype:t}),e}function Ai(t){return et(Di.prototype,function(n,r,i){this.db=t,this._tx=i,this.name=n,this.schema=r,this.hook=t._allTables[n]?t._allTables[n].hook:Et(null,{creating:[ci,K],reading:[li,We],updating:[fi,K],deleting:[hi,K]})})}function tt(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function hn(t,e){t.filter=Ee(t.filter,e)}function fn(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Ee(r(),e())}:e,t.justLimit=n&&!r}function Ii(t,e){t.isMatch=Ee(t.isMatch,e)}function kt(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new I.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function kr(t,e,n){var r=kt(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function Dt(t,e,n,r){var i=t.replayFilter?Ee(t.filter,t.replayFilter()):t.filter;if(t.or){var o={},s=function(a,u,l){if(!i||i(u,l,function(m){return u.stop(m)},function(m){return u.fail(m)})){var c=u.primaryKey,f=""+c;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(c)),ie(o,f)||(o[f]=!0,e(a,u,l))}};return Promise.all([t.or._iterate(s,n),Dr(kr(t,r,n),t.algorithm,s,!t.keysOnly&&t.valueMapper)])}else return Dr(kr(t,r,n),Ee(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Dr(t,e,n,r){var i=r?function(s,a,u){return n(r(s),a,u)}:n,o=L(i);return t.then(function(s){if(s)return s.start(function(){var a=function(){return s.continue()};(!e||e(s,function(u){return a=u},function(u){s.stop(u),a=K},function(u){s.fail(u),a=K}))&&o(s.value,s,function(u){return a=u}),a()})})}var Ti=function(){function t(){}return t.prototype._read=function(e,n){var r=this._ctx;return r.error?r.table._trans(null,$.bind(null,r.error)):r.table._trans("readonly",e).then(n)},t.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,$.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},t.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=Ee(n.algorithm,e)},t.prototype._iterate=function(e,n){return Dt(this._ctx,e,n,this._ctx.table.core)},t.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&re(r,e),n._ctx=r,n},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(e){var n=this._ctx;return this._read(function(r){return Dt(n,e,r,n.table.core)})},t.prototype.count=function(e){var n=this;return this._read(function(r){var i=n._ctx,o=i.table.core;if(tt(i,!0))return o.count({trans:r,query:{index:kt(i,o.schema),range:i.range}}).then(function(a){return Math.min(a,i.limit)});var s=0;return Dt(i,function(){return++s,!1},r,o).then(function(){return s})}).then(e)},t.prototype.sortBy=function(e,n){var r=e.split(".").reverse(),i=r[0],o=r.length-1;function s(l,c){return c?s(l[r[c]],c-1):l[i]}var a=this._ctx.dir==="next"?1:-1;function u(l,c){var f=s(l,o),m=s(c,o);return f<m?-a:f>m?a:0}return this.toArray(function(l){return l.sort(u)}).then(n)},t.prototype.toArray=function(e){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&tt(i,!0)&&i.limit>0){var o=i.valueMapper,s=kt(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:s,range:i.range}}).then(function(u){var l=u.result;return o?l.map(o):l})}else{var a=[];return Dt(i,function(u){return a.push(u)},r,i.table.core).then(function(){return a})}},e)},t.prototype.offset=function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,tt(n)?fn(n,function(){var r=e;return function(i,o){return r===0?!0:r===1?(--r,!1):(o(function(){i.advance(r),r=0}),!1)}}):fn(n,function(){var r=e;return function(){return--r<0}}),this)},t.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),fn(this._ctx,function(){var n=e;return function(r,i,o){return--n<=0&&i(o),n>=0}},!0),this},t.prototype.until=function(e,n){return hn(this._ctx,function(r,i,o){return e(r.value)?(i(o),n):!0}),this},t.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},t.prototype.last=function(e){return this.reverse().first(e)},t.prototype.filter=function(e){return hn(this._ctx,function(n){return e(n.value)}),Ii(this._ctx,e),this},t.prototype.and=function(e){return this.filter(e)},t.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},t.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})},t.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},t.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},t.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.key)}).then(function(){return r}).then(e)},t.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&tt(n,!0)&&n.limit>0)return this._read(function(i){var o=kt(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:o,range:n.range}})}).then(function(i){var o=i.result;return o}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.primaryKey)}).then(function(){return r}).then(e)},t.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},t.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},t.prototype.lastKey=function(e){return this.reverse().firstKey(e)},t.prototype.distinct=function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return hn(this._ctx,function(i){var o=i.primaryKey.toString(),s=ie(r,o);return r[o]=!0,!s}),this},t.prototype.modify=function(e){var n=this,r=this._ctx;return this._write(function(i){var o;if(typeof e=="function")o=e;else{var s=Q(e),a=s.length;o=function(g){for(var y=!1,v=0;v<a;++v){var h=s[v],C=e[h];se(g,h)!==C&&(oe(g,h,C),y=!0)}return y}}var u=r.table.core,l=u.schema.primaryKey,c=l.outbound,f=l.extractKey,m="testmode"in nt?1:2e3,w=n.db.core.cmp,d=[],p=0,b=[],x=function(g,y){var v=y.failures,h=y.numFailures;p+=g-h;for(var C=0,D=Q(v);C<D.length;C++){var S=D[C];d.push(v[S])}};return n.clone().primaryKeys().then(function(g){var y=function(v){var h=Math.min(m,g.length-v);return u.getMany({trans:i,keys:g.slice(v,v+h)}).then(function(C){for(var D=[],S=[],A=c?[]:null,B=[],R=0;R<h;++R){var U=C[R],F={value:qe(U),primKey:g[v+R]};o.call(F,F.value,F)!==!1&&(F.value==null?B.push(g[v+R]):!c&&w(f(U),f(F.value))!==0?(B.push(g[v+R]),D.push(F.value)):(S.push(F.value),c&&A.push(g[v+R])))}return Promise.resolve(D.length>0&&u.mutate({trans:i,type:"add",values:D}).then(function(V){for(var N in V.failures)B.splice(parseInt(N),1);x(D.length,V)})).then(function(V){return S.length>0&&u.mutate({trans:i,type:"put",keys:A,values:S}).then(function(N){return x(S.length,N)})}).then(function(){return B.length>0&&u.mutate({trans:i,type:"delete",keys:B}).then(function(V){return x(B.length,V)})}).then(function(){return g.length>v+h&&y(v+m)})})};return y(0).then(function(){if(d.length>0)throw new ct("Error modifying one or more objects",d,p,b);return g.length})})})},t.prototype.delete=function(){var e=this._ctx,n=e.range;return tt(e)&&(e.isPrimKey&&!ki||n.type===3)?this._write(function(r){var i=e.table.core.schema.primaryKey,o=n;return e.table.core.count({trans:r,query:{index:i,range:o}}).then(function(s){return e.table.core.mutate({trans:r,type:"deleteRange",range:o}).then(function(a){var u=a.failures,l=a.lastResult,c=a.results,f=a.numFailures;if(f)throw new ct("Could not delete some values",Object.keys(u).map(function(m){return u[m]}),s-f);return s-f})})}):this.modify(function(r,i){return i.value=null})},t}();function Ri(t){return et(Ti.prototype,function(n,r){this.db=t;var i=Er,o=null;if(r)try{i=r()}catch(l){o=l}var s=n._ctx,a=s.table,u=a.hook.reading.fire;this._ctx={table:a,index:s.index,isPrimKey:!s.index||a.schema.primKey.keyPath&&s.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:Infinity,error:o,or:s.or,valueMapper:u!==We?u:null}})}function Ni(t,e){return t<e?-1:t===e?0:1}function Oi(t,e){return t>e?-1:t===e?0:1}function ee(t,e,n){var r=t instanceof Ar?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function Me(t){return new t.Collection(t,function(){return Ir("")}).limit(0)}function Bi(t){return t==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function Mi(t){return t==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function Pi(t,e,n,r,i,o){for(var s=Math.min(t.length,r.length),a=-1,u=0;u<s;++u){var l=e[u];if(l!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;i(t[u],l)<0&&(a=u)}return s<r.length&&o==="next"?t+n.substr(t.length):s<t.length&&o==="prev"?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function At(t,e,n,r){var i,o,s,a,u,l,c,f=n.length;if(!n.every(function(p){return typeof p=="string"}))return ee(t,Cr);function m(p){i=Bi(p),o=Mi(p),s=p==="next"?Ni:Oi;var b=n.map(function(x){return{lower:o(x),upper:i(x)}}).sort(function(x,g){return s(x.lower,g.lower)});a=b.map(function(x){return x.upper}),u=b.map(function(x){return x.lower}),l=p,c=p==="next"?"":r}m("next");var w=new t.Collection(t,function(){return ye(a[0],u[f-1]+r)});w._ondirectionchange=function(p){m(p)};var d=0;return w._addAlgorithm(function(p,b,x){var g=p.key;if(typeof g!="string")return!1;var y=o(g);if(e(y,u,d))return!0;for(var v=null,h=d;h<f;++h){var C=Pi(g,y,a[h],u[h],s,l);C===null&&v===null?d=h+1:(v===null||s(v,C)>0)&&(v=C)}return b(v!==null?function(){p.continue(v+c)}:x),!1}),w}function ye(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Ir(t){return{type:1,lower:t,upper:t}}var Ar=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!0,configurable:!0}),t.prototype.between=function(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&!(r&&i)?Me(this):new this.Collection(this,function(){return ye(e,n,!r,!i)})}catch(o){return ee(this,de)}},t.prototype.equals=function(e){return e==null?ee(this,de):new this.Collection(this,function(){return Ir(e)})},t.prototype.above=function(e){return e==null?ee(this,de):new this.Collection(this,function(){return ye(e,void 0,!0)})},t.prototype.aboveOrEqual=function(e){return e==null?ee(this,de):new this.Collection(this,function(){return ye(e,void 0,!1)})},t.prototype.below=function(e){return e==null?ee(this,de):new this.Collection(this,function(){return ye(void 0,e,!1,!0)})},t.prototype.belowOrEqual=function(e){return e==null?ee(this,de):new this.Collection(this,function(){return ye(void 0,e)})},t.prototype.startsWith=function(e){return typeof e!="string"?ee(this,Cr):this.between(e,e+Be,!0,!0)},t.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):At(this,function(n,r){return n.indexOf(r[0])===0},[e],Be)},t.prototype.equalsIgnoreCase=function(e){return At(this,function(n,r){return n===r[0]},[e],"")},t.prototype.anyOfIgnoreCase=function(){var e=fe.apply(Te,arguments);return e.length===0?Me(this):At(this,function(n,r){return r.indexOf(n)!==-1},e,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var e=fe.apply(Te,arguments);return e.length===0?Me(this):At(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},e,Be)},t.prototype.anyOf=function(){var e=this,n=fe.apply(Te,arguments),r=this._cmp;try{n.sort(r)}catch(s){return ee(this,de)}if(n.length===0)return Me(this);var i=new this.Collection(this,function(){return ye(n[0],n[n.length-1])});i._ondirectionchange=function(s){r=s==="next"?e._ascending:e._descending,n.sort(r)};var o=0;return i._addAlgorithm(function(s,a,u){for(var l=s.key;r(l,n[o])>0;)if(++o,o===n.length)return a(u),!1;return r(l,n[o])===0?!0:(a(function(){s.continue(n[o])}),!1)}),i},t.prototype.notEqual=function(e){return this.inAnyRange([[an,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var e=fe.apply(Te,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch(r){return ee(this,de)}var n=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[an,i]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(e,n){var r=this,i=this._cmp,o=this._ascending,s=this._descending,a=this._min,u=this._max;if(e.length===0)return Me(this);if(!e.every(function(h){return h[0]!==void 0&&h[1]!==void 0&&o(h[0],h[1])<=0}))return ee(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",I.InvalidArgument);var l=!n||n.includeLowers!==!1,c=n&&n.includeUppers===!0;function f(h,C){for(var D=0,S=h.length;D<S;++D){var A=h[D];if(i(C[0],A[1])<0&&i(C[1],A[0])>0){A[0]=a(A[0],C[0]),A[1]=u(A[1],C[1]);break}}return D===S&&h.push(C),h}var m=o;function w(h,C){return m(h[0],C[0])}var d;try{d=e.reduce(f,[]),d.sort(w)}catch(h){return ee(this,de)}var p=0,b=c?function(h){return o(h,d[p][1])>0}:function(h){return o(h,d[p][1])>=0},x=l?function(h){return s(h,d[p][0])>0}:function(h){return s(h,d[p][0])>=0};function g(h){return!b(h)&&!x(h)}var y=b,v=new this.Collection(this,function(){return ye(d[0][0],d[d.length-1][1],!l,!c)});return v._ondirectionchange=function(h){h==="next"?(y=b,m=o):(y=x,m=s),d.sort(w)},v._addAlgorithm(function(h,C,D){for(var S=h.key;y(S);)if(++p,p===d.length)return C(D),!1;return g(S)?!0:(r._cmp(S,d[p][1])===0||r._cmp(S,d[p][0])===0||C(function(){m===o?h.continue(d[p][0]):h.continue(d[p][1])}),!1)}),v},t.prototype.startsWithAnyOf=function(){var e=fe.apply(Te,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?Me(this):this.inAnyRange(e.map(function(n){return[n,n+Be]})):ee(this,"startsWithAnyOf() only works with strings")},t}();function Ki(t){return et(Ar.prototype,function(n,r,i){this.db=t,this._ctx={table:n,index:r===":id"?null:r,or:i};var o=t._deps.indexedDB;if(!o)throw new I.MissingAPI("indexedDB API missing");this._cmp=this._ascending=o.cmp.bind(o),this._descending=function(s,a){return o.cmp(a,s)},this._max=function(s,a){return o.cmp(s,a)>0?s:a},this._min=function(s,a){return o.cmp(s,a)<0?s:a},this._IDBKeyRange=t._deps.IDBKeyRange})}function Tr(t){return t.length===1?t[0]:t}function dn(t){try{return t.only([[]]),[[]]}catch(e){return Be}}function ue(t){return L(function(e){return rt(e),t(e.target.error),!1})}function rt(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Fi=function(){function t(){}return t.prototype._lock=function(){return Ue(!k.global),++this._reculock,this._reculock===1&&!k.global&&(k.lockOwnerFor=this),this},t.prototype._unlock=function(){if(Ue(!k.global),--this._reculock==0)for(k.global||(k.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Qe(e[1],e[0])}catch(n){}}return this},t.prototype._locked=function(){return this._reculock&&k.lockOwnerFor!==this},t.prototype.create=function(e){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(Ue(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new I.DatabaseClosed(i);case"MissingAPIError":throw new I.MissingAPI(i.message,i);default:throw new I.OpenFailed(i)}if(!this.active)throw new I.TransactionInactive;return Ue(this._completion._state===null),e=this.idbtrans=e||r.transaction(Tr(this.storeNames),this.mode),e.onerror=L(function(o){rt(o),n._reject(e.error)}),e.onabort=L(function(o){rt(o),n.active&&n._reject(new I.Abort(e.error)),n.active=!1,n.on("abort").fire(o)}),e.oncomplete=L(function(){n.active=!1,n._resolve()}),this},t.prototype._promise=function(e,n,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return $(new I.ReadOnly("Transaction is readonly"));if(!this.active)return $(new I.TransactionInactive);if(this._locked())return new _(function(s,a){i._blockedFuncs.push([function(){i._promise(e,n,r).then(s,a)},k])});if(r)return Se(function(){var s=new _(function(a,u){i._lock();var l=n(a,u,i);l&&l.then&&l.then(a,u)});return s.finally(function(){return i._unlock()}),s._lib=!0,s});var o=new _(function(s,a){var u=n(s,a,i);u&&u.then&&u.then(s,a)});return o._lib=!0,o},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(e){var n=this._root(),r=_.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function s(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-Infinity).onsuccess=s)})()}var o=n._waitingFor;return new _(function(s,a){r.then(function(u){return n._waitingQueue.push(L(s.bind(null,u)))},function(u){return n._waitingQueue.push(L(a.bind(null,u)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},t.prototype.abort=function(){this.active&&this._reject(new I.Abort),this.active=!1},t.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(ie(n,e))return n[e];var r=this.schema[e];if(!r)throw new I.NotFound("Table "+e+" not part of transaction");var i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i},t}();function ji(t){return et(Fi.prototype,function(n,r,i,o){var s=this;this.db=t,this.mode=n,this.storeNames=r,this.schema=i,this.idbtrans=null,this.on=Et(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new _(function(a,u){s._resolve=a,s._reject=u}),this._completion.then(function(){s.active=!1,s.on.complete.fire()},function(a){var u=s.active;return s.active=!1,s.on.error.fire(a),s.parent?s.parent._reject(a):u&&s.idbtrans&&s.idbtrans.abort(),$(a)})})}function pn(t,e,n,r,i,o,s){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:o,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+Rr(e)}}function Rr(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Nr(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Xn(n,function(r){return[r.name,r]})}}function vn(t){return t==null?function(){}:typeof t=="string"?Li(t):function(e){return se(e,t)}}function Li(t){var e=t.split(".");return e.length===1?function(n){return n[t]}:function(n){return se(n,t)}}function Or(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}function Vi(t,e,n){return e.type==="add"?Promise.resolve(new Array(e.values.length)):t.getMany({trans:e.trans,keys:n})}function Br(t){return[].slice.call(t)}var Ui=0;function it(t){return t==null?":id":typeof t=="string"?t:"["+t.join("+")+"]"}function qi(t,e,n,r){var i=e.cmp.bind(e);function o(w,d){var p=Br(w.objectStoreNames);return{schema:{name:w.name,tables:p.map(function(b){return d.objectStore(b)}).map(function(b){var x=b.keyPath,g=b.autoIncrement,y=Z(x),v=x==null,h={},C={name:b.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:v,compound:y,keyPath:x,autoIncrement:g,unique:!0,extractKey:vn(x)},indexes:Br(b.indexNames).map(function(D){return b.index(D)}).map(function(D){var S=D.name,A=D.unique,B=D.multiEntry,R=D.keyPath,U=Z(R),F={name:S,compound:U,keyPath:R,unique:A,multiEntry:B,extractKey:vn(R)};return h[it(R)]=F,F}),getIndexByKeyPath:function(D){return h[it(D)]}};return h[":id"]=C.primaryKey,x!=null&&(h[it(x)]=C.primaryKey),C})},hasGetAll:p.length>0&&"getAll"in d.objectStore(p[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function s(w){if(w.type===3)return null;if(w.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var d=w.lower,p=w.upper,b=w.lowerOpen,x=w.upperOpen,g=d===void 0?p===void 0?null:n.upperBound(p,!!x):p===void 0?n.lowerBound(d,!!b):n.bound(d,p,!!b,!!x);return g}function a(w){var d=w.name;function p(g){var y=g.trans,v=g.type,h=g.keys,C=g.values,D=g.range,S=g.wantResults;return new Promise(function(A,B){A=L(A);var R=y.objectStore(d),U=R.keyPath==null,F=v==="put"||v==="add";if(!F&&v!=="delete"&&v!=="deleteRange")throw new Error("Invalid operation type: "+v);var V=(h||C||{length:1}).length;if(h&&C&&h.length!==C.length)throw new Error("Given keys array must have same length as given values array.");if(V===0)return A({numFailures:0,failures:{},results:[],lastResult:void 0});var N=S&&Lt(h||Or(w.primaryKey,{type:v,keys:h,values:C})),z,T=[],te=0,ne=function(H){++te,rt(H),N&&(N[H.target._reqno]=void 0),T[H.target._reqno]=H.target.error},ke=function(H){var pe=H.target;N[pe._reqno]=pe.result};if(v==="deleteRange"){if(D.type===4)return A({numFailures:te,failures:T,results:N,lastResult:void 0});D.type===3?z=R.clear():z=R.delete(s(D))}else{var le=F?U?[C,h]:[C,null]:[h,null],Pe=le[0],ce=le[1];if(F)for(var G=0;G<V;++G)z=ce&&ce[G]!==void 0?R[v](Pe[G],ce[G]):R[v](Pe[G]),z._reqno=G,N&&N[G]===void 0&&(z.onsuccess=ke),z.onerror=ne;else for(var G=0;G<V;++G)z=R[v](Pe[G]),z._reqno=G,z.onerror=ne}var De=function(H){var pe=H.target.result;N&&(N[V-1]=pe),A({numFailures:te,failures:T,results:N,lastResult:pe})};z.onerror=function(H){ne(H),De(H)},z.onsuccess=De})}function b(g){var y=g.trans,v=g.values,h=g.query,C=g.reverse,D=g.unique;return new Promise(function(S,A){S=L(S);var B=h.index,R=h.range,U=y.objectStore(d),F=B.isPrimaryKey?U:U.index(B.name),V=C?D?"prevunique":"prev":D?"nextunique":"next",N=v||!("openKeyCursor"in F)?F.openCursor(s(R),V):F.openKeyCursor(s(R),V);N.onerror=ue(A),N.onsuccess=L(function(z){var T=N.result;if(!T){S(null);return}T.___id=++Ui,T.done=!1;var te=T.continue.bind(T),ne=T.continuePrimaryKey;ne&&(ne=ne.bind(T));var ke=T.advance.bind(T),le=function(){throw new Error("Cursor not started")},Pe=function(){throw new Error("Cursor not stopped")};T.trans=y,T.stop=T.continue=T.continuePrimaryKey=T.advance=le,T.fail=L(A),T.next=function(){var ce=this,G=1;return this.start(function(){return G--?ce.continue():ce.stop()}).then(function(){return ce})},T.start=function(ce){var G=new Promise(function(H,pe){H=L(H),N.onerror=ue(pe),T.fail=pe,T.stop=function(Fr){T.stop=T.continue=T.continuePrimaryKey=T.advance=Pe,H(Fr)}}),De=function(){if(N.result)try{ce()}catch(H){T.fail(H)}else T.done=!0,T.start=function(){throw new Error("Cursor behind last entry")},T.stop()};return N.onsuccess=L(function(H){N.onsuccess=De,De()}),T.continue=te,T.continuePrimaryKey=ne,T.advance=ke,De(),G},S(T)},A)})}function x(g){return function(y){return new Promise(function(v,h){v=L(v);var C=y.trans,D=y.values,S=y.limit,A=y.query,B=S===Infinity?void 0:S,R=A.index,U=A.range,F=C.objectStore(d),V=R.isPrimaryKey?F:F.index(R.name),N=s(U);if(S===0)return v({result:[]});if(g){var z=D?V.getAll(N,B):V.getAllKeys(N,B);z.onsuccess=function(ke){return v({result:ke.target.result})},z.onerror=ue(h)}else{var T=0,te=D||!("openKeyCursor"in V)?V.openCursor(N):V.openKeyCursor(N),ne=[];te.onsuccess=function(ke){var le=te.result;if(!le)return v({result:ne});if(ne.push(D?le.value:le.primaryKey),++T===S)return v({result:ne});le.continue()},te.onerror=ue(h)}})}}return{name:d,schema:w,mutate:p,getMany:function(g){var y=g.trans,v=g.keys;return new Promise(function(h,C){h=L(h);for(var D=y.objectStore(d),S=v.length,A=new Array(S),B=0,R=0,U,F=function(T){var te=T.target;(A[te._pos]=te.result)!=null,++R===B&&h(A)},V=ue(C),N=0;N<S;++N){var z=v[N];z!=null&&(U=D.get(v[N]),U._pos=N,U.onsuccess=F,U.onerror=V,++B)}B===0&&h(A)})},get:function(g){var y=g.trans,v=g.key;return new Promise(function(h,C){h=L(h);var D=y.objectStore(d),S=D.get(v);S.onsuccess=function(A){return h(A.target.result)},S.onerror=ue(C)})},query:x(c),openCursor:b,count:function(g){var y=g.query,v=g.trans,h=y.index,C=y.range;return new Promise(function(D,S){var A=v.objectStore(d),B=h.isPrimaryKey?A:A.index(h.name),R=s(C),U=R?B.count(R):B.count();U.onsuccess=L(function(F){return D(F.target.result)}),U.onerror=ue(S)})}}}var u=o(t,r),l=u.schema,c=u.hasGetAll,f=l.tables.map(function(w){return a(w)}),m={};return f.forEach(function(w){return m[w.name]=w}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(w){var d=m[w];if(!d)throw new Error("Table '"+w+"' not found");return m[w]},cmp:i,MIN_KEY:-Infinity,MAX_KEY:dn(n),schema:l}}function Hi(t,e){return e.reduce(function(n,r){var i=r.create;return P(P({},n),i(n))},t)}function Wi(t,e,n,r){var i=n.IDBKeyRange,o=n.indexedDB,s=Hi(qi(e,o,i,r),t.dbcore);return{dbcore:s}}function mn(t,e){var n=e.db,r=Wi(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(function(i){var o=i.name;t.core.schema.tables.some(function(s){return s.name===o})&&(i.core=t.core.table(o),t[o]instanceof t.Table&&(t[o].core=i.core))})}function It(t,e,n,r){n.forEach(function(i){var o=r[i];e.forEach(function(s){var a=Vt(s,i);(!a||"value"in a&&a.value===void 0)&&(s===t.Transaction.prototype||s instanceof t.Transaction?he(s,i,{get:function(){return this.table(i)},set:function(u){Gn(this,i,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):s[i]=new t.Table(i,o))})})}function yn(t,e){e.forEach(function(n){for(var r in n)n[r]instanceof t.Table&&delete n[r]})}function zi(t,e){return t._cfg.version-e._cfg.version}function Yi(t,e,n,r){var i=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,i);o.create(n),o._completion.catch(r);var s=o._reject.bind(o),a=k.transless||k;Se(function(){k.trans=o,k.transless=a,e===0?(Q(i).forEach(function(u){gn(n,u,i[u].primKey,i[u].indexes)}),mn(t,n),_.follow(function(){return t.on.populate.fire(o)}).catch(s)):Gi(t,e,o,n).catch(s)})}function Gi(t,e,n,r){var i=[],o=t._versions,s=t._dbSchema=bn(t,t.idbdb,r),a=!1,u=o.filter(function(c){return c._cfg.version>=e});u.forEach(function(c){i.push(function(){var f=s,m=c._cfg.dbschema;_n(t,f,r),_n(t,m,r),s=t._dbSchema=m;var w=Mr(f,m);w.add.forEach(function(y){gn(r,y[0],y[1].primKey,y[1].indexes)}),w.change.forEach(function(y){if(y.recreate)throw new I.Upgrade("Not yet support for changing primary key");var v=r.objectStore(y.name);y.add.forEach(function(h){return wn(v,h)}),y.change.forEach(function(h){v.deleteIndex(h.name),wn(v,h)}),y.del.forEach(function(h){return v.deleteIndex(h)})});var d=c._cfg.contentUpgrade;if(d&&c._cfg.version>e){mn(t,r),n._memoizedTables={},a=!0;var p=Jn(m);w.del.forEach(function(y){p[y]=f[y]}),yn(t,[t.Transaction.prototype]),It(t,[t.Transaction.prototype],Q(p),p),n.schema=p;var b=nr(d);b&&Je();var x,g=_.follow(function(){if(x=d(n),x&&b){var y=Ce.bind(null,null);x.then(y,y)}});return x&&typeof x.then=="function"?_.resolve(x):g.then(function(){return x})}}),i.push(function(f){if(!a||!Ei){var m=c._cfg.dbschema;Xi(m,f)}yn(t,[t.Transaction.prototype]),It(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),n.schema=t._dbSchema})});function l(){return i.length?_.resolve(i.shift()(n.idbtrans)).then(l):_.resolve()}return l().then(function(){Qi(s,r)})}function Mr(t,e){var n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],o=e[r];if(!i)n.add.push([r,o]);else{var s={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!un)s.recreate=!0,n.change.push(s);else{var a=i.idxByName,u=o.idxByName,l=void 0;for(l in a)u[l]||s.del.push(l);for(l in u){var c=a[l],f=u[l];c?c.src!==f.src&&s.change.push(f):s.add.push(f)}(s.del.length>0||s.add.length>0||s.change.length>0)&&n.change.push(s)}}}return n}function gn(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(o){return wn(i,o)}),i}function Qi(t,e){Q(t).forEach(function(n){e.db.objectStoreNames.contains(n)||gn(e,n,t[n].primKey,t[n].indexes)})}function Xi(t,e){for(var n=0;n<e.db.objectStoreNames.length;++n){var r=e.db.objectStoreNames[n];t[r]==null&&e.db.deleteObjectStore(r)}}function wn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function bn(t,e,n){var r={},i=lt(e.objectStoreNames,0);return i.forEach(function(o){for(var s=n.objectStore(o),a=s.keyPath,u=pn(Rr(a),a||"",!1,!1,!!s.autoIncrement,a&&typeof a!="string",!0),l=[],c=0;c<s.indexNames.length;++c){var f=s.index(s.indexNames[c]);a=f.keyPath;var m=pn(f.name,a,!!f.unique,!!f.multiEntry,!1,a&&typeof a!="string",!1);l.push(m)}r[o]=Nr(o,u,l)}),r}function $i(t,e,n){t.verno=e.version/10;var r=t._dbSchema=bn(t,e,n);t._storeNames=lt(e.objectStoreNames,0),It(t,[t._allTables],Q(r),r)}function Ji(t,e){var n=bn(t,t.idbdb,e),r=Mr(n,t._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function _n(t,e,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var o=r[i],s=n.objectStore(o);t._hasGetAll="getAll"in s;for(var a=0;a<s.indexNames.length;++a){var u=s.indexNames[a],l=s.index(u).keyPath,c=typeof l=="string"?l:"["+lt(l).join("+")+"]";if(e[o]){var f=e[o].idxByName[c];f&&(f.name=u,delete e[o].idxByName[c],e[o].idxByName[u]=f)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&j.WorkerGlobalScope&&j instanceof j.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function Zi(t){return t.split(",").map(function(e,n){e=e.trim();var r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return pn(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Z(i),n===0)})}var eo=function(){function t(){}return t.prototype._parseStoresSpec=function(e,n){Q(e).forEach(function(r){if(e[r]!==null){var i=Zi(e[r]),o=i.shift();if(o.multi)throw new I.Schema("Primary key cannot be multi-valued");i.forEach(function(s){if(s.auto)throw new I.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new I.Schema("Index must have a name and cannot be an empty string")}),n[r]=Nr(r,o,i)}})},t.prototype.stores=function(e){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?re(this._cfg.storesSource,e):e;var r=n._versions,i={},o={};return r.forEach(function(s){re(i,s._cfg.storesSource),o=s._cfg.dbschema={},s._parseStoresSpec(i,o)}),n._dbSchema=o,yn(n,[n._allTables,n,n.Transaction.prototype]),It(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],Q(o),o),n._storeNames=Q(o),this},t.prototype.upgrade=function(e){return this._cfg.contentUpgrade=e,this},t}();function to(t){return et(eo.prototype,function(n){this.db=t,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}var ot;function no(t){var e=t&&typeof t.databases=="function",n;if(!e){var r=new nt(Ct,{addons:[]});r.version(1).stores({dbnames:"name"}),n=r.table("dbnames")}return{getDatabaseNames:function(){return e?_.resolve(t.databases()).then(function(i){return i.map(function(o){return o.name}).filter(function(o){return o!==Ct})}):n.toCollection().primaryKeys()},add:function(i){return!e&&i!==Ct&&n.put({name:i}).catch(K)},remove:function(i){return!e&&i!==Ct&&n.delete(i).catch(K)}}}function ro(t){try{ot=no(t)}catch(e){}}function xn(t){return Se(function(){return k.letThrough=!0,t()})}function io(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?$(e.dbOpenError):t});ae&&(e.openCanceller._stackHolder=Re()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.dbReadyResolve,i=null;return _.race([e.openCanceller,new _(function(o,s){if(!n)throw new I.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var a=t.name,u=e.autoSchema?n.open(a):n.open(a,Math.round(t.verno*10));if(!u)throw new I.MissingAPI("IndexedDB API not available");u.onerror=ue(s),u.onblocked=L(t._fireOnBlocked),u.onupgradeneeded=L(function(l){if(i=u.transaction,e.autoSchema&&!t._options.allowEmptyDB){u.onerror=rt,i.abort(),u.result.close();var c=n.deleteDatabase(a);c.onsuccess=c.onerror=L(function(){s(new I.NoSuchDatabase("Database "+a+" doesnt exist"))})}else{i.onerror=ue(s);var f=l.oldVersion>Math.pow(2,62)?0:l.oldVersion;t.idbdb=u.result,Yi(t,f/10,i,s)}},s),u.onsuccess=L(function(){i=null;var l=t.idbdb=u.result,c=lt(l.objectStoreNames);if(c.length>0)try{var f=l.transaction(Tr(c),"readonly");e.autoSchema?$i(t,l,f):(_n(t,t._dbSchema,f),Ji(t,f)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),mn(t,f)}catch(m){}Ze.push(t),l.onversionchange=L(function(m){e.vcFired=!0,t.on("versionchange").fire(m)}),ot.add(a),o()},s)})]).then(function(){return e.onReadyBeingFired=[],_.resolve(xn(t.on.ready.fire)).then(function o(){if(e.onReadyBeingFired.length>0){var s=e.onReadyBeingFired.reduce(ur,K);return e.onReadyBeingFired=[],_.resolve(xn(s)).then(o)}})}).finally(function(){e.onReadyBeingFired=null}).then(function(){return e.isBeingOpened=!1,t}).catch(function(o){try{i&&i.abort()}catch(s){}return e.isBeingOpened=!1,t.close(),e.dbOpenError=o,$(e.dbOpenError)}).finally(function(){e.openComplete=!0,r()})}function Cn(t){var e=function(s){return t.next(s)},n=function(s){return t.throw(s)},r=o(e),i=o(n);function o(s){return function(a){var u=s(a),l=u.value;return u.done?l:!l||typeof l.then!="function"?Z(l)?Promise.all(l).then(r,i):r(l):l.then(r,i)}}return o(e)()}function oo(t,e,n){var r=arguments.length;if(r<2)throw new I.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var o=Zn(i);return[t,o,n]}function so(t,e,n,r,i){return _.resolve().then(function(){var o=k.transless||k,s=t._createTransaction(e,n,t._dbSchema,r),a={trans:s,transless:o};r?s.idbtrans=r.idbtrans:s.create();var u=nr(i);u&&Je();var l,c=_.follow(function(){if(l=i.call(s,s),l)if(u){var f=Ce.bind(null,null);l.then(f,f)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=Cn(l))},a);return(l&&typeof l.then=="function"?_.resolve(l).then(function(f){return s.active?f:$(new I.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):c.then(function(){return l})).then(function(f){return r&&s._resolve(),s._completion.then(function(){return f})}).catch(function(f){return s._reject(f),$(f)})})}function st(t,e,n){for(var r=Z(t)?t.slice():[t],i=0;i<n;++i)r.push(e);return r}function ao(t){return P(P({},t),{table:function(e){var n=t.table(e),r=n.schema,i={},o=[];function s(p,b,x){var g=it(p),y=i[g]=i[g]||[],v=p==null?0:typeof p=="string"?1:p.length,h=b>0,C=P(P({},x),{isVirtual:h,isPrimaryKey:!h&&x.isPrimaryKey,keyTail:b,keyLength:v,extractKey:vn(p),unique:!h&&x.unique});if(y.push(C),C.isPrimaryKey||o.push(C),v>1){var D=v===2?p[0]:p.slice(0,v-1);s(D,b+1,x)}return y.sort(function(S,A){return S.keyTail-A.keyTail}),C}var a=s(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(var u=0,l=r.indexes;u<l.length;u++){var c=l[u];s(c.keyPath,0,c)}function f(p){var b=i[it(p)];return b&&b[0]}function m(p,b){return{type:p.type===1?2:p.type,lower:st(p.lower,p.lowerOpen?t.MAX_KEY:t.MIN_KEY,b),lowerOpen:!0,upper:st(p.upper,p.upperOpen?t.MIN_KEY:t.MAX_KEY,b),upperOpen:!0}}function w(p){var b=p.query.index;return b.isVirtual?P(P({},p),{query:{index:b,range:m(p.query.range,b.keyTail)}}):p}var d=P(P({},n),{schema:P(P({},r),{primaryKey:a,indexes:o,getIndexByKeyPath:f}),count:function(p){return n.count(w(p))},query:function(p){return n.query(w(p))},openCursor:function(p){var b=p.query.index,x=b.keyTail,g=b.isVirtual,y=b.keyLength;if(!g)return n.openCursor(p);function v(h){function C(S){S!=null?h.continue(st(S,p.reverse?t.MAX_KEY:t.MIN_KEY,x)):p.unique?h.continue(st(h.key,p.reverse?t.MIN_KEY:t.MAX_KEY,x)):h.continue()}var D=Object.create(h,{continue:{value:C},continuePrimaryKey:{value:function(S,A){h.continuePrimaryKey(st(S,t.MAX_KEY,x),A)}},key:{get:function(){var S=h.key;return y===1?S[0]:S.slice(0,y)}},value:{get:function(){return h.value}}});return D}return n.openCursor(w(p)).then(function(h){return h&&v(h)})}});return d}})}var uo={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:ao},lo={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return P(P({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey,i=P(P({},n),{mutate:function(o){var s=k.trans,a=s.table(e).hook,u=a.deleting,l=a.creating,c=a.updating;switch(o.type){case"add":if(l.fire===K)break;return s._promise("readwrite",function(){return f(o)},!0);case"put":if(l.fire===K&&c.fire===K)break;return s._promise("readwrite",function(){return f(o)},!0);case"delete":if(u.fire===K)break;return s._promise("readwrite",function(){return f(o)},!0);case"deleteRange":if(u.fire===K)break;return s._promise("readwrite",function(){return m(o)},!0)}return n.mutate(o);function f(d){var p=k.trans,b=d.keys||Or(r,d);if(!b)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?P(P({},d),{keys:b,wantResults:!0}):P({},d),d.type!=="delete"&&(d.values=Lt(d.values)),d.keys&&(d.keys=Lt(d.keys)),Vi(n,d,b).then(function(x){var g=b.map(function(y,v){var h=x[v],C={onerror:null,onsuccess:null};if(d.type==="delete")u.fire.call(C,y,h,p);else if(d.type==="add"||h===void 0){var D=l.fire.call(C,y,d.values[v],p);y==null&&D!=null&&(y=D,d.keys[v]=y,r.outbound||oe(d.values[v],r.keyPath,y))}else{var S=Ht(h,d.values[v]),A=c.fire.call(C,S,y,h,p);if(A){var B=d.values[v];Object.keys(A).forEach(function(R){ie(B,R)?B[R]=A[R]:oe(B,R,A[R])})}}return C});return n.mutate(d).then(function(y){for(var v=y.failures,h=y.results,C=y.numFailures,D=y.lastResult,S=0;S<b.length;++S){var A=h?h[S]:b[S],B=g[S];A==null?B.onerror&&B.onerror(v[S]):B.onsuccess&&B.onsuccess(d.type==="put"&&x[S]?d.values[S]:A)}return{failures:v,results:h,numFailures:C,lastResult:D}}).catch(function(y){return g.forEach(function(v){return v.onerror&&v.onerror(y)}),Promise.reject(y)})})}function m(d){return w(d.trans,d.range,1e4)}function w(d,p,b){return n.query({trans:d,values:!1,query:{index:r,range:p},limit:b}).then(function(x){var g=x.result;return f({type:"delete",keys:g,trans:d}).then(function(y){return y.numFailures>0?Promise.reject(y.failures[0]):g.length<b?{failures:[],numFailures:0,lastResult:void 0}:w(d,P(P({},p),{lower:g[g.length-1],lowerOpen:!0}),b)})})}}});return i}})}},nt=function(){function t(e,n){var r=this;this._middlewares={},this.verno=0;var i=t.dependencies;this._options=n=P({addons:t.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var o=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null;var s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:K,dbReadyPromise:null,cancelOpen:K,openCanceller:null,autoSchema:!0};s.dbReadyPromise=new _(function(a){s.dbReadyResolve=a}),s.openCanceller=new _(function(a,u){s.cancelOpen=u}),this._state=s,this.name=e,this.on=Et(this,"populate","blocked","versionchange",{ready:[ur,K]}),this.on.ready.subscribe=Yn(this.on.ready.subscribe,function(a){return function(u,l){t.vip(function(){var c=r._state;if(c.openComplete)c.dbOpenError||_.resolve().then(u),l&&a(u);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(u),l&&a(u);else{a(u);var f=r;l||a(function m(){f.on.ready.unsubscribe(u),f.on.ready.unsubscribe(m)})}})}}),this.Collection=Ri(this),this.Table=Ai(this),this.Transaction=ji(this),this.Version=to(this),this.WhereClause=Ki(this),this.on("versionchange",function(a){a.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(a){!a.newVersion||a.newVersion<a.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+a.oldVersion/10)}),this._maxKey=dn(n.IDBKeyRange),this._createTransaction=function(a,u,l,c){return new r.Transaction(a,u,l,c)},this._fireOnBlocked=function(a){r.on("blocked").fire(a),Ze.filter(function(u){return u.name===r.name&&u!==r&&!u._state.vcFired}).map(function(u){return u.on("versionchange").fire(a)})},this.use(uo),this.use(lo),o.forEach(function(a){return a(r)})}return t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new I.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new I.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,r=n.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),n.push(r),n.sort(zi),r.stores({}),this._state.autoSchema=!1,r)},t.prototype._whenReady=function(e){var n=this;return this._state.openComplete||k.letThrough?e():new _(function(r,i){if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new I.DatabaseClosed);return}n.open().catch(K)}n._state.dbReadyPromise.then(r,i)}).then(e)},t.prototype.use=function(e){var n=e.stack,r=e.create,i=e.level,o=e.name;o&&this.unuse({stack:n,name:o});var s=this._middlewares[n]||(this._middlewares[n]=[]);return s.push({stack:n,create:r,level:i??10,name:o}),s.sort(function(a,u){return a.level-u.level}),this},t.prototype.unuse=function(e){var n=e.stack,r=e.name,i=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(o){return i?o.create!==i:r?o.name!==r:!1})),this},t.prototype.open=function(){return io(this)},t.prototype.close=function(){var e=Ze.indexOf(this),n=this._state;if(e>=0&&Ze.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(r){}this.idbdb=null}this._options.autoOpen=!1,n.dbOpenError=new I.DatabaseClosed,n.isBeingOpened&&n.cancelOpen(n.dbOpenError),n.dbReadyPromise=new _(function(r){n.dbReadyResolve=r}),n.openCanceller=new _(function(r,i){n.cancelOpen=i})},t.prototype.delete=function(){var e=this,n=arguments.length>0,r=this._state;return new _(function(i,o){var s=function(){e.close();var a=e._deps.indexedDB.deleteDatabase(e.name);a.onsuccess=L(function(){ot.remove(e.name),i()}),a.onerror=ue(o),a.onblocked=e._fireOnBlocked};if(n)throw new I.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()})},t.prototype.backendDB=function(){return this.idbdb},t.prototype.isOpen=function(){return this.idbdb!==null},t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(t.prototype,"tables",{get:function(){var e=this;return Q(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!0,configurable:!0}),t.prototype.transaction=function(){var e=oo.apply(this,arguments);return this._transaction.apply(this,e)},t.prototype._transaction=function(e,n,r){var i=this,o=k.trans;(!o||o.db!==this||e.indexOf("!")!==-1)&&(o=null);var s=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var a,u;try{if(u=n.map(function(c){var f=c instanceof i.Table?c.name:c;if(typeof f!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),e=="r"||e===ln)a=ln;else if(e=="rw"||e==cn)a=cn;else throw new I.InvalidArgument("Invalid transaction mode: "+e);if(o){if(o.mode===ln&&a===cn)if(s)o=null;else throw new I.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o&&u.forEach(function(c){if(o&&o.storeNames.indexOf(c)===-1)if(s)o=null;else throw new I.SubTransaction("Table "+c+" not included in parent transaction.")}),s&&o&&!o.active&&(o=null)}}catch(c){return o?o._promise(null,function(f,m){m(c)}):$(c)}var l=so.bind(null,this,a,u,o,r);return o?o._promise(a,l,"lock"):k.trans?Qe(k.transless,function(){return i._whenReady(l)}):this._whenReady(l)},t.prototype.table=function(e){if(!ie(this._allTables,e))throw new I.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},t}(),ge=nt;Ve(ge,P(P({},ht),{delete:function(t){var e=new ge(t);return e.delete()},exists:function(t){return new ge(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){return ot?ot.getDatabaseNames().then(t):_.resolve([])},defineClass:function(){function t(e){re(this,e)}return t},ignoreTransaction:function(t){return k.trans?Qe(k.transless,t):t()},vip:xn,async:function(t){return function(){try{var e=Cn(t.apply(this,arguments));return!e||typeof e.then!="function"?_.resolve(e):e}catch(n){return $(n)}}},spawn:function(t,e,n){try{var r=Cn(t.apply(n,e||[]));return!r||typeof r.then!="function"?_.resolve(r):r}catch(i){return $(i)}},currentTransaction:{get:function(){return k.trans||null}},waitFor:function(t,e){var n=_.resolve(typeof t=="function"?ge.ignoreTransaction(t):t).timeout(e||6e4);return k.trans?k.trans.waitFor(n):n},Promise:_,debug:{get:function(){return ae},set:function(t){ir(t,t==="dexie"?function(){return!0}:Sr)}},derive:Ie,extend:re,props:Ve,override:Yn,Events:Et,getByKeyPath:se,setByKeyPath:oe,delByKeyPath:$n,shallowClone:Jn,deepClone:qe,getObjectDiff:Ht,asap:Qn,minKey:an,addons:[],connections:Ze,errnames:si,dependencies:function(){try{return{indexedDB:j.indexedDB||j.mozIndexedDB||j.webkitIndexedDB||j.msIndexedDB,IDBKeyRange:j.IDBKeyRange||j.webkitIDBKeyRange}}catch(t){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:xr,version:xr.split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,n*2)}),default:ge,Dexie:ge}));ge.maxKey=dn(ge.dependencies.IDBKeyRange);ro(nt.dependencies.indexedDB);_.rejectionMapper=ui;ir(ae,Sr);var Pr=nt;var Sn=class extends Pr{constructor(){super("SamplesDatabase");this.version(1).stores({samples:"id, data, label, volume, speed, compressor, filter, distortion"}),this.samples=this.table("samples")}};var En=class{constructor(e,n,r){this.id=e,this.handler=n,this.isSampleEntity=!0,this.isRecordingEntity=!0,this.db=new Sn,this.baseSpeed=r.getPositionForLogRangeValue(1,.1,3)}loadCache(){this.db.samples.each(e=>{this.handler.emitSample(e)}).then(()=>this.handler.onCacheLoaded()).catch(()=>{})}onSampleNodeValueChange(e,n,r){this.db.samples.update(e,{[n]:r}).catch(()=>{})}onRecorded(e){let n={id:this.handler.createID(),data:e,label:`Sample ${new Date().toUTCString()}`,compressor:1,distortion:1,lowpass:1,speed:this.baseSpeed,volume:500001};this.db.samples.add(n).then(()=>{this.handler.emitSample(n)}).catch(()=>{})}onRecordingStateChanged(e){e===E.streamInitiated&&this.loadCache()}onSampleError(){}onSampleSelectedChanged(){}onSampleCreated(){}onSampleStateChanged(){}onRecordingError(e){}};var kn=class{constructor(e,n,r){this.core=e,this.math=n,this.id=r.id,this.audioNodeManager=new Ke(r.id),this.isAudioNodeManaged=!0,this.isSampleEntity=!0;let i=this.core.context().createBuffer(1,r.data.length,this.core.context().sampleRate);this.bufferNode=this.core.context().createBufferSource(),i.copyToChannel(r.data,0),this.bufferNode.buffer=i,this.bufferNode.loop=!0,this.setSpeed(r.speed),this.volumeNode=this.core.context().createGain(),this.setVolume(r.volume),this.audioNodeManager.setOutput(this.volumeNode),this.lowpassFilterNode=this.core.context().createBiquadFilter(),this.lowpassFilterNode.frequency.value=6e3,this.lowpassFilterNode.type="lowpass",this.setLowpass(r.lowpass),this.lowpassFilterNode.connect(this.volumeNode),this.distortionFilterNode=this.core.context().createWaveShaper(),this.distortionFilterNode.oversample="4x",this.distortionCurveData=new Float32Array(this.core.context().sampleRate),this.curve(0),this.distortionFilterNode.curve=this.distortionCurveData,this.setDistortion(r.distortion),this.distortionFilterNode.connect(this.lowpassFilterNode),this.compressorGainNode=this.core.context().createGain(),this.compressorGainNode.gain.setValueAtTime(-1,this.core.context().currentTime),this.compressorFilterNode=this.core.context().createDynamicsCompressor(),this.setCompressor(r.compressor),this.compressorGainNode.connect(this.compressorFilterNode),this.compressorFilterNode.connect(this.distortionFilterNode)}curve(e){let n=typeof e=="number"?~~e:50,r=Math.PI/180,i=0;for(let o=0;o<this.core.context().sampleRate;++o)i=o*2/this.core.context().sampleRate-1,this.distortionCurveData[o]=(10+n)*i*50*r/(Math.PI+n*Math.abs(i))}ramp(e,n,r){e.linearRampToValueAtTime(n,r)}rampTime(){return this.core.context().currentTime+.5}setCompressor(e){this.ramp(this.compressorGainNode.gain,this.math.exponentialValueInRange(e,-1,-1),this.rampTime()),this.ramp(this.compressorFilterNode.threshold,0-this.math.exponentialValueInRange(e,10,100),this.rampTime()),this.ramp(this.compressorFilterNode.knee,this.math.exponentialValueInRange(e,4,40),this.rampTime()),this.ramp(this.compressorFilterNode.ratio,this.math.exponentialValueInRange(e,2,20),this.rampTime()),this.ramp(this.compressorFilterNode.release,Math.pow(20,-1*this.math.exponentialValueInRange(e,1,1e3)),this.rampTime())}setDistortion(e){this.curve(this.math.exponentialValueInRange(e,0,1e4)),this.distortionFilterNode.curve=this.distortionCurveData}setLowpass(e){this.ramp(this.lowpassFilterNode.frequency,6e3-this.math.exponentialValueInRange(e,0,5950*.005)*200,this.rampTime())}setSpeed(e){this.ramp(this.bufferNode.playbackRate,this.math.exponentialValueInRange(e,.1,3),this.rampTime())}setVolume(e){this.ramp(this.volumeNode.gain,this.math.exponentialValueInRange(e,0,3),this.rampTime())}onSampleStateChanged(e,n,r){if(e===this.id)switch(n){case W.playing:r===W.notStarted&&this.bufferNode.start(),this.bufferNode.connect(this.compressorGainNode);break;case W.paused:this.bufferNode.disconnect(this.compressorGainNode);break}}onSampleError(e){}onSampleNodeValueChange(e,n,r){if(e===this.id)switch(n){case q.compressor:this.setCompressor(r);break;case q.distortion:this.setDistortion(r);break;case q.lowpass:this.setLowpass(r);break;case q.speed:this.setSpeed(r);break;case q.volume:this.setVolume(r);break}}onSampleSelectedChanged(){}onSampleCreated(){}};var Kr=class{constructor(e,n,r){let i=10,o=4096;this.contextNodeID="context",this.contextNode=new Nt(this.contextNodeID),this._entities=[],this.mathUtility=new Ot,this.cache=new En(this.createID(),this,this.mathUtility),this.addEntity(this.cache),this.recordingHandler=new Tt(this,this.contextNode,n,o,i,this.cache),this.sampleHandler=new Rt(this),this.ui=new jt(this.createID(),this,this.sampleHandler,e,this.recordingHandler,i,r),this.addEntity(this.ui),this.onCacheLoaded=this.recordingHandler.appReady}emitSample(e){let n=new kn(this.contextNode,this.mathUtility,e);this.addEntity(n),n.audioNodeManager.connectOutput(this.contextNode),this.sampleHandler.onSampleCreated(e)}addEntity(e){this._entities.push(e)}createID(){return An(10)}entities(){return this._entities}};export{Kr as Schallvernichtung};
